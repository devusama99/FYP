{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"width\", \"height\", \"x\", \"y\", \"opacity\", \"scaleX\", \"scaleY\"];\n\nfunction ownKeys(a, b) {\n  var c = Object.keys(a);\n\n  if (Object.getOwnPropertySymbols) {\n    var d = Object.getOwnPropertySymbols(a);\n    b && (d = d.filter(function (b) {\n      return Object.getOwnPropertyDescriptor(a, b).enumerable;\n    })), c.push.apply(c, d);\n  }\n\n  return c;\n}\n\nfunction _objectSpread(a) {\n  for (var b, c = 1; c < arguments.length; c++) b = null == arguments[c] ? {} : arguments[c], c % 2 ? ownKeys(Object(b), !0).forEach(function (c) {\n    _defineProperty(a, c, b[c]);\n  }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(a, Object.getOwnPropertyDescriptors(b)) : ownKeys(Object(b)).forEach(function (c) {\n    Object.defineProperty(a, c, Object.getOwnPropertyDescriptor(b, c));\n  });\n\n  return a;\n}\n\nimport { ELLIPSE_CROP, TOOLS_IDS, WATERMARK_ANNOTATION_ID } from \"./constants\";\nimport getImageSealingParams from \"./getImageSealingParams\";\nimport mapCropBox from \"./mapCropBox\";\nimport mapNumber from \"./mapNumber\";\nimport toPrecisedFloat from \"./toPrecisedFloat\";\n\nvar generateCropQuery = function (a, b, c) {\n  var d = mapCropBox(a, b, c),\n      e = d.x,\n      f = d.y,\n      g = d.width,\n      h = d.height;\n  return \"tl_px=\".concat(e, \",\").concat(f, \"&br_px=\").concat(e + g, \",\").concat(f + h).concat(a.ratio === ELLIPSE_CROP ? \"&radius=\".concat(Math.max(g, h), \"&force_format=png\") : \"\");\n},\n    generateResizeQuery = function () {\n  var a = 0 < arguments.length && arguments[0] !== void 0 ? arguments[0] : {},\n      b = a.width,\n      c = a.height;\n  return \"w=\".concat(b, \"&h=\").concat(c);\n},\n    generateRotationQuery = function (a) {\n  return \"r=\".concat(-a);\n},\n    generateFlipQuery = function (a, b) {\n  return \"flip=\".concat(a ? \"x\" : \"\").concat(b ? \"y\" : \"\");\n},\n    generateWatermarkQuery = function () {\n  var a,\n      b = 0 < arguments.length && arguments[0] !== void 0 ? arguments[0] : {},\n      c = 1 < arguments.length ? arguments[1] : void 0,\n      d = 2 < arguments.length && arguments[2] !== void 0 ? arguments[2] : {},\n      e = b.width,\n      f = b.height,\n      g = b.x,\n      h = b.y,\n      i = b.opacity,\n      j = b.scaleX,\n      k = void 0 === j ? 1 : j,\n      l = b.scaleY,\n      m = void 0 === l ? 1 : l,\n      n = _objectWithoutProperties(b, _excluded),\n      o = c.width * c.scaledBy,\n      p = c.height * c.scaledBy,\n      q = \"wat=1&wat_gravity=absolute&wat_opacity=\".concat(i, \"&wat_pos=\").concat(Math.floor(100 * ((g - (d.x || 0)) / o), 2), \"p,\").concat(Math.floor(100 * ((h - (d.y || 0)) / p), 2), \"p\");\n\n  if (b.name === TOOLS_IDS.TEXT) return \"\".concat(q, \"&wat_text=\").concat(n.text.replaceAll(\"\\n\", \"\"), \"&wat_font=\").concat(n.fontFamily, \"&wat_color=\").concat(n.fill.replace(\"#\", \"\"), \"&wat_fontsize=\").concat(n.fontSize, \"max\");\n  var r = (null === (a = n.image) || void 0 === a ? void 0 : a.src) || n.image,\n      s = !r.startsWith(\"blob:\") && r;\n  return \"\".concat(q, \"&wat_scale=\").concat(toPrecisedFloat(100 * (e * k / o), 2), \"p,\").concat(toPrecisedFloat(100 * (f * m / p), 2), \"p\").concat(s ? \"&wat_url=\".concat(encodeURIComponent(s)) : \"\");\n};\n\nexport var finetuneNameToParamInfo = {\n  Brighten: {\n    cloudimage: {\n      name: \"bright\",\n      min: -100,\n      max: 100\n    },\n    internal: {\n      propName: \"brightness\",\n      min: -1,\n      max: 1\n    }\n  },\n  Contrast: {\n    cloudimage: {\n      name: \"contrast\",\n      min: -100,\n      max: 100\n    },\n    internal: {\n      propName: \"contrast\",\n      min: -100,\n      max: 100\n    }\n  },\n  Blur: {\n    cloudimage: {\n      name: \"blur\",\n      min: 0,\n      max: 100\n    },\n    internal: {\n      propName: \"blurRadius\",\n      min: 0,\n      max: 100\n    }\n  }\n};\n\nvar generateFinetuneQuery = function (a) {\n  var b = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {},\n      c = [];\n  return a.forEach(function (a) {\n    var d = a.name && finetuneNameToParamInfo[a.name];\n\n    if (d) {\n      var e = toPrecisedFloat(mapNumber(b[d.internal.propName], d.internal.min, d.internal.max, d.cloudimage.min, d.cloudimage.max), 2);\n      c.push(\"\".concat(d.cloudimage.name, \"=\").concat(e));\n    }\n  }), c.join(\"&\");\n},\n    operationsToCloudimageUrl = function (a, b, c, d) {\n  var e = a.token,\n      f = a.domain,\n      g = a.dontPrefixUrl,\n      h = a.version,\n      i = a.imageSealing,\n      j = a.secureProtocol,\n      k = b.imgSrc,\n      l = b.adjustments,\n      m = l.crop,\n      n = l.rotation,\n      o = l.isFlippedX,\n      p = l.isFlippedY,\n      q = b.resize,\n      r = void 0 === q ? {} : q,\n      s = b.finetunes,\n      t = void 0 === s ? {} : s,\n      u = b.finetunesProps,\n      v = b.annotations,\n      w = void 0 === v ? {} : v,\n      x = g ? \"\" : \"http\".concat(j ? \"s\" : \"\", \"://\").concat(e, \".\").concat(f.replace(/^(https?:\\/\\/)?(www\\.)?|^\\.|\\/$/g, \"\"), \"/\").concat(h ? \"\".concat(h, \"/\") : \"\"),\n      y = [];\n  m.width && m.height && (m.x || 0 === m.x) && (m.y || 0 === m.y) && y.push(generateCropQuery(m, c, d)), (r.width || r.height) && y.push(generateResizeQuery(_objectSpread(_objectSpread({}, d), r))), n && y.push(generateRotationQuery(n)), (o || p) && y.push(generateFlipQuery(o, p)), 0 < t.length && u && y.push(generateFinetuneQuery(t, u)), w[WATERMARK_ANNOTATION_ID] && y.push(generateWatermarkQuery(w[WATERMARK_ANNOTATION_ID], c, m)), y.push(\"ci_url_encoded=1\");\n  var z = y.join(\"&\");\n  i.enable && (z = getImageSealingParams(z, i, k)), z = z.replaceAll(\" \", \"+\");\n  var A = !g && \"?\" || -1 === k.indexOf(\"?\") ? \"?\" : \"&\";\n  return \"\".concat(x).concat(g ? k : encodeURIComponent(k)).concat(z ? \"\".concat(A).concat(z.replace(/&$/, \"\")) : \"\");\n};\n\nexport default operationsToCloudimageUrl;","map":{"version":3,"sources":["/Users/devusama/Work/FYP_FrontEnd/node_modules/react-filerobot-image-editor/lib/utils/operationsToCloudimageUrl.js"],"names":["_defineProperty","_objectWithoutProperties","_excluded","ownKeys","a","b","c","Object","keys","getOwnPropertySymbols","d","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","ELLIPSE_CROP","TOOLS_IDS","WATERMARK_ANNOTATION_ID","getImageSealingParams","mapCropBox","mapNumber","toPrecisedFloat","generateCropQuery","e","x","f","y","g","width","h","height","concat","ratio","Math","max","generateResizeQuery","generateRotationQuery","generateFlipQuery","generateWatermarkQuery","i","opacity","j","scaleX","k","l","scaleY","m","n","o","scaledBy","p","q","floor","name","TEXT","text","replaceAll","fontFamily","fill","replace","fontSize","r","image","src","s","startsWith","encodeURIComponent","finetuneNameToParamInfo","Brighten","cloudimage","min","internal","propName","Contrast","Blur","generateFinetuneQuery","join","operationsToCloudimageUrl","token","domain","dontPrefixUrl","version","imageSealing","secureProtocol","imgSrc","adjustments","crop","rotation","isFlippedX","isFlippedY","resize","finetunes","t","u","finetunesProps","v","annotations","w","z","enable","A","indexOf"],"mappings":"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","sourcesContent":["import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";var _excluded=[\"width\",\"height\",\"x\",\"y\",\"opacity\",\"scaleX\",\"scaleY\"];function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import{ELLIPSE_CROP,TOOLS_IDS,WATERMARK_ANNOTATION_ID}from\"./constants\";import getImageSealingParams from\"./getImageSealingParams\";import mapCropBox from\"./mapCropBox\";import mapNumber from\"./mapNumber\";import toPrecisedFloat from\"./toPrecisedFloat\";var generateCropQuery=function(a,b,c){var d=mapCropBox(a,b,c),e=d.x,f=d.y,g=d.width,h=d.height;return\"tl_px=\".concat(e,\",\").concat(f,\"&br_px=\").concat(e+g,\",\").concat(f+h).concat(a.ratio===ELLIPSE_CROP?\"&radius=\".concat(Math.max(g,h),\"&force_format=png\"):\"\")},generateResizeQuery=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=a.width,c=a.height;return\"w=\".concat(b,\"&h=\").concat(c)},generateRotationQuery=function(a){return\"r=\".concat(-a)},generateFlipQuery=function(a,b){return\"flip=\".concat(a?\"x\":\"\").concat(b?\"y\":\"\")},generateWatermarkQuery=function(){var a,b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},c=1<arguments.length?arguments[1]:void 0,d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},e=b.width,f=b.height,g=b.x,h=b.y,i=b.opacity,j=b.scaleX,k=void 0===j?1:j,l=b.scaleY,m=void 0===l?1:l,n=_objectWithoutProperties(b,_excluded),o=c.width*c.scaledBy,p=c.height*c.scaledBy,q=\"wat=1&wat_gravity=absolute&wat_opacity=\".concat(i,\"&wat_pos=\").concat(Math.floor(100*((g-(d.x||0))/o),2),\"p,\").concat(Math.floor(100*((h-(d.y||0))/p),2),\"p\");if(b.name===TOOLS_IDS.TEXT)return\"\".concat(q,\"&wat_text=\").concat(n.text.replaceAll(\"\\n\",\"\"),\"&wat_font=\").concat(n.fontFamily,\"&wat_color=\").concat(n.fill.replace(\"#\",\"\"),\"&wat_fontsize=\").concat(n.fontSize,\"max\");var r=(null===(a=n.image)||void 0===a?void 0:a.src)||n.image,s=!r.startsWith(\"blob:\")&&r;return\"\".concat(q,\"&wat_scale=\").concat(toPrecisedFloat(100*(e*k/o),2),\"p,\").concat(toPrecisedFloat(100*(f*m/p),2),\"p\").concat(s?\"&wat_url=\".concat(encodeURIComponent(s)):\"\")};export var finetuneNameToParamInfo={Brighten:{cloudimage:{name:\"bright\",min:-100,max:100},internal:{propName:\"brightness\",min:-1,max:1}},Contrast:{cloudimage:{name:\"contrast\",min:-100,max:100},internal:{propName:\"contrast\",min:-100,max:100}},Blur:{cloudimage:{name:\"blur\",min:0,max:100},internal:{propName:\"blurRadius\",min:0,max:100}}};var generateFinetuneQuery=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=[];return a.forEach(function(a){var d=a.name&&finetuneNameToParamInfo[a.name];if(d){var e=toPrecisedFloat(mapNumber(b[d.internal.propName],d.internal.min,d.internal.max,d.cloudimage.min,d.cloudimage.max),2);c.push(\"\".concat(d.cloudimage.name,\"=\").concat(e))}}),c.join(\"&\")},operationsToCloudimageUrl=function(a,b,c,d){var e=a.token,f=a.domain,g=a.dontPrefixUrl,h=a.version,i=a.imageSealing,j=a.secureProtocol,k=b.imgSrc,l=b.adjustments,m=l.crop,n=l.rotation,o=l.isFlippedX,p=l.isFlippedY,q=b.resize,r=void 0===q?{}:q,s=b.finetunes,t=void 0===s?{}:s,u=b.finetunesProps,v=b.annotations,w=void 0===v?{}:v,x=g?\"\":\"http\".concat(j?\"s\":\"\",\"://\").concat(e,\".\").concat(f.replace(/^(https?:\\/\\/)?(www\\.)?|^\\.|\\/$/g,\"\"),\"/\").concat(h?\"\".concat(h,\"/\"):\"\"),y=[];m.width&&m.height&&(m.x||0===m.x)&&(m.y||0===m.y)&&y.push(generateCropQuery(m,c,d)),(r.width||r.height)&&y.push(generateResizeQuery(_objectSpread(_objectSpread({},d),r))),n&&y.push(generateRotationQuery(n)),(o||p)&&y.push(generateFlipQuery(o,p)),0<t.length&&u&&y.push(generateFinetuneQuery(t,u)),w[WATERMARK_ANNOTATION_ID]&&y.push(generateWatermarkQuery(w[WATERMARK_ANNOTATION_ID],c,m)),y.push(\"ci_url_encoded=1\");var z=y.join(\"&\");i.enable&&(z=getImageSealingParams(z,i,k)),z=z.replaceAll(\" \",\"+\");var A=!g&&\"?\"||-1===k.indexOf(\"?\")?\"?\":\"&\";return\"\".concat(x).concat(g?k:encodeURIComponent(k)).concat(z?\"\".concat(A).concat(z.replace(/&$/,\"\")):\"\")};export default operationsToCloudimageUrl;"]},"metadata":{},"sourceType":"module"}