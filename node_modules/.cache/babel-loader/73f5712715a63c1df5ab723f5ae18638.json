{"ast":null,"code":"import _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nvar _excluded = [\"id\", \"x\", \"y\", \"points\"],\n    _excluded2 = [\"startedX\", \"startedY\", \"offsetX\", \"offsetY\", \"width\", \"height\"];\n\nfunction ownKeys(a, b) {\n  var c = Object.keys(a);\n\n  if (Object.getOwnPropertySymbols) {\n    var d = Object.getOwnPropertySymbols(a);\n    b && (d = d.filter(function (b) {\n      return Object.getOwnPropertyDescriptor(a, b).enumerable;\n    })), c.push.apply(c, d);\n  }\n\n  return c;\n}\n\nfunction _objectSpread(a) {\n  for (var b, c = 1; c < arguments.length; c++) b = null == arguments[c] ? {} : arguments[c], c % 2 ? ownKeys(Object(b), !0).forEach(function (c) {\n    _defineProperty(a, c, b[c]);\n  }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(a, Object.getOwnPropertyDescriptors(b)) : ownKeys(Object(b)).forEach(function (c) {\n    Object.defineProperty(a, c, Object.getOwnPropertyDescriptor(b, c));\n  });\n\n  return a;\n}\n\nimport { TOOLS_IDS } from \"../../utils/constants\";\nimport getElemDocumentCoords from \"../../utils/getElemDocumentCoords\";\nimport getPointerOffsetPositionBoundedToObject from \"../../utils/getPointerOffsetPositionBoundedToObject\";\nimport getBoundingRectUnScaled from \"./getBoundingRectUnScaled\";\nimport getNewAnnotationPreview, { dimensToProperAnnotationDimens, NO_WIDTH_HEIGHT_ANNOTATIONS } from \"./getNewAnnotationPreview\";\n\nvar pointerDown = {\n  startedX: void 0,\n  startedY: void 0,\n  isOutOfCanvas: !1\n},\n    eventsOptions = {\n  passive: !0\n},\n    MIN_PIXELS = 1,\n    shownAnnotationPreview = null,\n    textAnnotationWrappedRect = null,\n    latestAnnotationProps = null,\n    previewThenCallAnnotationAdding = function (a, b, c, d) {\n  var f = function () {\n    return getElemDocumentCoords(a.content);\n  },\n      g = function (a) {\n    textAnnotationWrappedRect = getNewAnnotationPreview(_objectSpread(_objectSpread({}, a), {}, {\n      name: TOOLS_IDS.RECT,\n      fill: \"\",\n      stroke: \"#000000\",\n      strokeWidth: 2,\n      shadowColor: \"#ffffff\",\n      shadowBlur: 1,\n      shadowOpacity: .7\n    })), c.add(textAnnotationWrappedRect);\n  },\n      h = function (a) {\n    shownAnnotationPreview = getNewAnnotationPreview(a), c.add(shownAnnotationPreview), a.name === TOOLS_IDS.TEXT && g(a), latestAnnotationProps = a;\n  },\n      i = function (a, b) {\n    var c = dimensToProperAnnotationDimens(a, latestAnnotationProps.name, b);\n    textAnnotationWrappedRect && textAnnotationWrappedRect.setAttrs(c), shownAnnotationPreview.setAttrs(c), latestAnnotationProps = _objectSpread(_objectSpread({}, latestAnnotationProps), c);\n  },\n      j = function (a) {\n    var b = getPointerOffsetPositionBoundedToObject(c, f());\n    i(getBoundingRectUnScaled(b, pointerDown, c), a.shiftKey);\n  },\n      k = function () {\n    c && shownAnnotationPreview && c.destroyChildren();\n  },\n      l = function (a) {\n    var d;\n\n    if (!(1 < (null === (d = a.evt.touches) || void 0 === d ? void 0 : d.length))) {\n      var e = getPointerOffsetPositionBoundedToObject(c, f());\n      pointerDown.isOutOfCanvas && (document.removeEventListener(\"mousemove\", j, eventsOptions), document.removeEventListener(\"touchmove\", j, eventsOptions), pointerDown.isOutOfCanvas = !1);\n      var g = getBoundingRectUnScaled(e, pointerDown, c);\n      if (shownAnnotationPreview) i(g, a.evt.shiftKey);else {\n        var k = b.id,\n            l = b.x,\n            m = b.y,\n            n = b.points,\n            o = _objectWithoutProperties(b, _excluded);\n\n        h(_objectSpread(_objectSpread({}, o), g));\n      }\n    }\n  },\n      m = function () {\n    pointerDown.isOutOfCanvas || (document.addEventListener(\"mousemove\", j, eventsOptions), document.addEventListener(\"touchmove\", j, eventsOptions), pointerDown.isOutOfCanvas = !0);\n  },\n      n = function () {\n    var c, e;\n\n    if (k(), latestAnnotationProps && (latestAnnotationProps.width >= MIN_PIXELS && latestAnnotationProps.height >= MIN_PIXELS || latestAnnotationProps.radiusX >= MIN_PIXELS && latestAnnotationProps.radiusY >= MIN_PIXELS || null !== (c = latestAnnotationProps.points) && void 0 !== c && c[2] || null !== (e = latestAnnotationProps.points) && void 0 !== e && e[3] || latestAnnotationProps.radius >= MIN_PIXELS)) {\n      var f = latestAnnotationProps,\n          g = f.startedX,\n          h = f.startedY,\n          i = f.offsetX,\n          o = f.offsetY,\n          p = f.width,\n          q = f.height,\n          r = _objectWithoutProperties(f, _excluded2);\n\n      NO_WIDTH_HEIGHT_ANNOTATIONS.includes(b.name) || (r.width = p, r.height = q), d(r, !0);\n    }\n\n    shownAnnotationPreview = null, textAnnotationWrappedRect = null, latestAnnotationProps = null, a.off(\"mousemove touchmove\", l), a.off(\"mouseleave touchcancel\", m), document.removeEventListener(\"mouseup\", n, eventsOptions), document.removeEventListener(\"touchend\", n, eventsOptions), document.removeEventListener(\"mouseleave\", n, eventsOptions), document.removeEventListener(\"touchcancel\", n, eventsOptions), document.removeEventListener(\"mousemove\", j, eventsOptions), document.removeEventListener(\"touchmove\", j, eventsOptions), pointerDown.isOutOfCanvas = !1;\n  },\n      o = function (b) {\n    var d;\n\n    if (b.evt.preventDefault(), !(b.target.attrs.draggable || 1 < (null === (d = b.evt.touches) || void 0 === d ? void 0 : d.length))) {\n      k();\n      var e = getPointerOffsetPositionBoundedToObject(c, f());\n      pointerDown.startedX = e.offsetX, pointerDown.startedY = e.offsetY, pointerDown.isOutOfCanvas = !1, a.on(\"mousemove touchmove\", l), a.on(\"mouseleave touchcancel\", m), document.addEventListener(\"mouseup\", n, eventsOptions), document.addEventListener(\"touchend\", n, eventsOptions), document.addEventListener(\"mouseleave\", n, eventsOptions), document.addEventListener(\"touchcancel\", n, eventsOptions);\n    }\n  };\n\n  return a.on(\"mousedown touchstart\", o), function () {\n    k(), a.off(\"mousedown touchstart\", o);\n  };\n};\n\nexport default previewThenCallAnnotationAdding;","map":{"version":3,"sources":["/Users/devusama/Work/FYP_FrontEnd/node_modules/react-filerobot-image-editor/lib/hooks/useAnnotation/previewThenCallAnnotationAdding.js"],"names":["_objectWithoutProperties","_defineProperty","_excluded","_excluded2","ownKeys","a","b","c","Object","keys","getOwnPropertySymbols","d","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","TOOLS_IDS","getElemDocumentCoords","getPointerOffsetPositionBoundedToObject","getBoundingRectUnScaled","getNewAnnotationPreview","dimensToProperAnnotationDimens","NO_WIDTH_HEIGHT_ANNOTATIONS","pointerDown","startedX","startedY","isOutOfCanvas","eventsOptions","passive","MIN_PIXELS","shownAnnotationPreview","textAnnotationWrappedRect","latestAnnotationProps","previewThenCallAnnotationAdding","f","content","g","name","RECT","fill","stroke","strokeWidth","shadowColor","shadowBlur","shadowOpacity","add","h","TEXT","i","setAttrs","j","shiftKey","k","destroyChildren","l","evt","touches","e","document","removeEventListener","id","x","m","y","n","points","o","addEventListener","width","height","radiusX","radiusY","radius","offsetX","offsetY","p","q","r","includes","off","preventDefault","target","attrs","draggable","on"],"mappings":"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","sourcesContent":["import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";var _excluded=[\"id\",\"x\",\"y\",\"points\"],_excluded2=[\"startedX\",\"startedY\",\"offsetX\",\"offsetY\",\"width\",\"height\"];function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import{TOOLS_IDS}from\"../../utils/constants\";import getElemDocumentCoords from\"../../utils/getElemDocumentCoords\";import getPointerOffsetPositionBoundedToObject from\"../../utils/getPointerOffsetPositionBoundedToObject\";import getBoundingRectUnScaled from\"./getBoundingRectUnScaled\";import getNewAnnotationPreview,{dimensToProperAnnotationDimens,NO_WIDTH_HEIGHT_ANNOTATIONS}from\"./getNewAnnotationPreview\";var pointerDown={startedX:void 0,startedY:void 0,isOutOfCanvas:!1},eventsOptions={passive:!0},MIN_PIXELS=1,shownAnnotationPreview=null,textAnnotationWrappedRect=null,latestAnnotationProps=null,previewThenCallAnnotationAdding=function(a,b,c,d){var f=function(){return getElemDocumentCoords(a.content)},g=function(a){textAnnotationWrappedRect=getNewAnnotationPreview(_objectSpread(_objectSpread({},a),{},{name:TOOLS_IDS.RECT,fill:\"\",stroke:\"#000000\",strokeWidth:2,shadowColor:\"#ffffff\",shadowBlur:1,shadowOpacity:.7})),c.add(textAnnotationWrappedRect)},h=function(a){shownAnnotationPreview=getNewAnnotationPreview(a),c.add(shownAnnotationPreview),a.name===TOOLS_IDS.TEXT&&g(a),latestAnnotationProps=a},i=function(a,b){var c=dimensToProperAnnotationDimens(a,latestAnnotationProps.name,b);textAnnotationWrappedRect&&textAnnotationWrappedRect.setAttrs(c),shownAnnotationPreview.setAttrs(c),latestAnnotationProps=_objectSpread(_objectSpread({},latestAnnotationProps),c)},j=function(a){var b=getPointerOffsetPositionBoundedToObject(c,f());i(getBoundingRectUnScaled(b,pointerDown,c),a.shiftKey)},k=function(){c&&shownAnnotationPreview&&c.destroyChildren()},l=function(a){var d;if(!(1<(null===(d=a.evt.touches)||void 0===d?void 0:d.length))){var e=getPointerOffsetPositionBoundedToObject(c,f());pointerDown.isOutOfCanvas&&(document.removeEventListener(\"mousemove\",j,eventsOptions),document.removeEventListener(\"touchmove\",j,eventsOptions),pointerDown.isOutOfCanvas=!1);var g=getBoundingRectUnScaled(e,pointerDown,c);if(shownAnnotationPreview)i(g,a.evt.shiftKey);else{var k=b.id,l=b.x,m=b.y,n=b.points,o=_objectWithoutProperties(b,_excluded);h(_objectSpread(_objectSpread({},o),g))}}},m=function(){pointerDown.isOutOfCanvas||(document.addEventListener(\"mousemove\",j,eventsOptions),document.addEventListener(\"touchmove\",j,eventsOptions),pointerDown.isOutOfCanvas=!0)},n=function(){var c,e;if(k(),latestAnnotationProps&&(latestAnnotationProps.width>=MIN_PIXELS&&latestAnnotationProps.height>=MIN_PIXELS||latestAnnotationProps.radiusX>=MIN_PIXELS&&latestAnnotationProps.radiusY>=MIN_PIXELS||null!==(c=latestAnnotationProps.points)&&void 0!==c&&c[2]||null!==(e=latestAnnotationProps.points)&&void 0!==e&&e[3]||latestAnnotationProps.radius>=MIN_PIXELS)){var f=latestAnnotationProps,g=f.startedX,h=f.startedY,i=f.offsetX,o=f.offsetY,p=f.width,q=f.height,r=_objectWithoutProperties(f,_excluded2);NO_WIDTH_HEIGHT_ANNOTATIONS.includes(b.name)||(r.width=p,r.height=q),d(r,!0)}shownAnnotationPreview=null,textAnnotationWrappedRect=null,latestAnnotationProps=null,a.off(\"mousemove touchmove\",l),a.off(\"mouseleave touchcancel\",m),document.removeEventListener(\"mouseup\",n,eventsOptions),document.removeEventListener(\"touchend\",n,eventsOptions),document.removeEventListener(\"mouseleave\",n,eventsOptions),document.removeEventListener(\"touchcancel\",n,eventsOptions),document.removeEventListener(\"mousemove\",j,eventsOptions),document.removeEventListener(\"touchmove\",j,eventsOptions),pointerDown.isOutOfCanvas=!1},o=function(b){var d;if(b.evt.preventDefault(),!(b.target.attrs.draggable||1<(null===(d=b.evt.touches)||void 0===d?void 0:d.length))){k();var e=getPointerOffsetPositionBoundedToObject(c,f());pointerDown.startedX=e.offsetX,pointerDown.startedY=e.offsetY,pointerDown.isOutOfCanvas=!1,a.on(\"mousemove touchmove\",l),a.on(\"mouseleave touchcancel\",m),document.addEventListener(\"mouseup\",n,eventsOptions),document.addEventListener(\"touchend\",n,eventsOptions),document.addEventListener(\"mouseleave\",n,eventsOptions),document.addEventListener(\"touchcancel\",n,eventsOptions)}};return a.on(\"mousedown touchstart\",o),function(){k(),a.off(\"mousedown touchstart\",o)}};export default previewThenCallAnnotationAdding;"]},"metadata":{},"sourceType":"module"}