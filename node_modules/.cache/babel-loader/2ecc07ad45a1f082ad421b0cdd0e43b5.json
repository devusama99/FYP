{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(a, b) {\n  var c = Object.keys(a);\n\n  if (Object.getOwnPropertySymbols) {\n    var d = Object.getOwnPropertySymbols(a);\n    b && (d = d.filter(function (b) {\n      return Object.getOwnPropertyDescriptor(a, b).enumerable;\n    })), c.push.apply(c, d);\n  }\n\n  return c;\n}\n\nfunction _objectSpread(a) {\n  for (var b, c = 1; c < arguments.length; c++) b = null == arguments[c] ? {} : arguments[c], c % 2 ? ownKeys(Object(b), !0).forEach(function (c) {\n    _defineProperty(a, c, b[c]);\n  }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(a, Object.getOwnPropertyDescriptors(b)) : ownKeys(Object(b)).forEach(function (c) {\n    Object.defineProperty(a, c, Object.getOwnPropertyDescriptor(b, c));\n  });\n\n  return a;\n}\n\nimport React, { useEffect, useRef, useState } from \"react\";\nimport MenuItem from \"@scaleflex/ui/core/menu-item\";\nimport SaveAs from \"@scaleflex/icons/save-as\";\nimport Label from \"@scaleflex/ui/core/label\";\nimport { useStore, useTransformedImgData } from \"../../hooks\";\nimport getFileFullName from \"../../utils/getFileFullName\";\nimport { CLOSING_REASONS, ELLIPSE_CROP, SUPPORTED_IMAGE_TYPES } from \"../../utils/constants\";\nimport { HIDE_LOADER, SET_FEEDBACK, SHOW_LOADER } from \"../../actions\";\nimport Modal from \"../common/Modal\";\nimport Slider from \"../common/Slider\";\nimport restrictNumber from \"../../utils/restrictNumber\";\nimport { Resize } from \"../tools/Resize\";\nimport ButtonWithMenu from \"../common/ButtonWithMenu\";\nimport { StyledFileExtensionSelect, StyledFileNameInput, StyledQualityWrapper, StyledResizeOnSave } from \"./Topbar.styled\";\n\nvar sliderStyle = {\n  marginBottom: 16\n},\n    saveButtonWrapperStyle = {\n  width: 67\n},\n    saveButtonMenuStyle = {\n  marginLeft: 12\n},\n    isFieSaveMounted = !0,\n    SaveButton = function () {\n  var a = useStore(),\n      b = useRef(),\n      c = a.theme,\n      d = a.dispatch,\n      e = a.originalImage,\n      f = a.resize,\n      g = a.isLoadingGlobally,\n      h = a.haveNotSavedChanges,\n      i = a.feedback,\n      j = a.t,\n      k = a.adjustments;\n  k = void 0 === k ? {} : k;\n\n  var l = k.crop,\n      m = a.config,\n      n = m.onClose,\n      o = m.closeAfterSave,\n      p = m.onBeforeSave,\n      q = m.onSave,\n      r = m.forceToPngInEllipticalCrop,\n      s = m.defaultSavedImageType,\n      t = m.useCloudimage,\n      u = m.moreSaveOptions,\n      v = useState(!1),\n      w = _slicedToArray(v, 2),\n      x = w[0],\n      y = w[1],\n      z = useState({\n    quality: .92\n  }),\n      A = _slicedToArray(z, 2),\n      B = A[0],\n      C = A[1],\n      D = useTransformedImgData(),\n      E = [\"jpeg\", \"jpg\", \"webp\"].includes(B.extension),\n      F = 0 === i.duration,\n      G = function () {\n    isFieSaveMounted && x && (b.current = null, y(!1));\n  },\n      H = function () {\n    var a = D(B, !1, !0),\n        c = b.current || q,\n        e = c(a.imageData, a.designState),\n        f = function () {\n      d({\n        type: HIDE_LOADER\n      });\n    };\n\n    e instanceof Promise ? e[\"finally\"](f) : f(), b.current = null, o && n && n(CLOSING_REASONS.AFTER_SAVE, h);\n  },\n      I = function () {\n    d({\n      type: SHOW_LOADER\n    }), y(!1), setTimeout(H, 3);\n  },\n      J = function () {\n    var a = b.current || q;\n    if (\"function\" != typeof a) throw new Error(\"Please provide onSave function handler.\");\n    return B.name && B.extension ? void I() : void d({\n      type: SET_FEEDBACK,\n      payload: {\n        feedback: {\n          message: j(\"nameIsRequired\")\n        }\n      }\n    });\n  },\n      K = function () {\n    if (t) {\n      var a = D(B),\n          c = b.current || q;\n      return void c(a.imageData, a.designState);\n    }\n\n    return b.current || \"function\" != typeof p || !1 !== p(B) ? void y(!0) : void J();\n  },\n      L = function (a, c) {\n    if (\"function\" == typeof a) b.current = a, c();else throw new Error(\"onSave function callback is required as an argument to the passed function.\");\n  };\n\n  useEffect(function () {\n    if (e && (!B.name || !B.extension)) {\n      var a = getFileFullName(e.name, r && l.ratio === ELLIPSE_CROP ? \"png\" : SUPPORTED_IMAGE_TYPES.includes(null === s || void 0 === s ? void 0 : s.toLowerCase()) && s),\n          b = a.name,\n          c = a.extension;\n      C(_objectSpread(_objectSpread({}, B), {}, {\n        name: b,\n        extension: c\n      }));\n    }\n  }, [e, x]), useEffect(function () {\n    C(_objectSpread(_objectSpread({}, B), {}, {\n      size: {\n        width: f.width,\n        height: f.height\n      }\n    }));\n  }, [f]), useEffect(function () {\n    return isFieSaveMounted = !0, function () {\n      isFieSaveMounted = !1;\n    };\n  }, []);\n  var M = Array.isArray(u) && 0 < u.length ? u.map(function (a, b) {\n    return _objectSpread(_objectSpread({}, a), {}, {\n      key: \"\".concat(a.label || b, \"-option-key\"),\n      onClick: \"function\" == typeof a.onClick ? function () {\n        return a.onClick(function (a) {\n          return L(a, K);\n        }, function (a) {\n          return L(a, I);\n        });\n      } : void 0\n    });\n  }) : [];\n  return React.createElement(React.Fragment, null, React.createElement(ButtonWithMenu, {\n    className: \"FIE_topbar-save\",\n    color: \"primary\",\n    label: j(\"save\"),\n    onClick: K,\n    menuPosition: \"bottom\",\n    menuItems: M,\n    menuStyle: saveButtonMenuStyle,\n    wrapperStyle: saveButtonWrapperStyle,\n    disabled: g || F\n  }), x && React.createElement(Modal, {\n    className: \"FIE_save-modal\",\n    title: j(\"saveAsModalLabel\"),\n    Icon: function Icon(a) {\n      return React.createElement(SaveAs, _extends({\n        color: c.palette[\"accent-primary\"]\n      }, a));\n    },\n    isOpened: x,\n    onCancel: G,\n    onDone: J,\n    doneLabel: j(\"save\"),\n    cancelLabel: j(\"cancel\"),\n    doneButtonColor: \"primary\",\n    areButtonsDisabled: g,\n    zIndex: 11110\n  }, React.createElement(StyledFileNameInput, {\n    className: \"FIE_save-file-name-input\",\n    value: B.name,\n    onChange: function changeFileName(a) {\n      var b = a.target.value;\n      C(_objectSpread(_objectSpread({}, B), {}, {\n        name: b\n      }));\n    },\n    size: \"sm\",\n    placeholder: j(\"name\"),\n    error: !!B.name,\n    focusOnMount: !0\n  }), React.createElement(StyledFileExtensionSelect, {\n    className: \"FIE_save-extension-selector\",\n    onChange: function onChange(a) {\n      return C(_objectSpread(_objectSpread({}, B), {}, {\n        extension: a\n      }));\n    },\n    value: B.extension,\n    placeholder: j(\"extension\"),\n    size: \"sm\"\n  }, SUPPORTED_IMAGE_TYPES.map(function (a) {\n    return React.createElement(MenuItem, {\n      key: a,\n      value: a\n    }, a);\n  })), E && React.createElement(StyledQualityWrapper, {\n    className: \"FIE_save-quality-wrapper\"\n  }, React.createElement(Label, null, j(\"quality\")), React.createElement(Slider, {\n    annotation: \"%\",\n    min: 1,\n    max: 100,\n    onChange: function changeQuality(a) {\n      C(_objectSpread(_objectSpread({}, B), {}, {\n        quality: restrictNumber(a / 100, .01, 1)\n      }));\n    },\n    value: parseInt(100 * B.quality, 10),\n    width: \"100%\",\n    style: sliderStyle\n  })), React.createElement(StyledResizeOnSave, {\n    className: \"FIE_save-resize-wrapper\"\n  }, React.createElement(Label, null, j(\"resize\")), React.createElement(Resize, {\n    onChange: function resizeImageFile(a) {\n      C(_objectSpread(_objectSpread({}, B), {}, {\n        size: _objectSpread(_objectSpread({}, B.size), a)\n      }));\n    },\n    currentSize: (null === B || void 0 === B ? void 0 : B.size) || {},\n    hideResetButton: !0,\n    alignLeft: !0\n  }))));\n};\n\nexport default SaveButton;","map":{"version":3,"sources":["/Users/devusama/Work/FYP_FrontEnd/node_modules/react-filerobot-image-editor/lib/components/Topbar/SaveButton.js"],"names":["_extends","_defineProperty","_slicedToArray","ownKeys","a","b","c","Object","keys","getOwnPropertySymbols","d","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","React","useEffect","useRef","useState","MenuItem","SaveAs","Label","useStore","useTransformedImgData","getFileFullName","CLOSING_REASONS","ELLIPSE_CROP","SUPPORTED_IMAGE_TYPES","HIDE_LOADER","SET_FEEDBACK","SHOW_LOADER","Modal","Slider","restrictNumber","Resize","ButtonWithMenu","StyledFileExtensionSelect","StyledFileNameInput","StyledQualityWrapper","StyledResizeOnSave","sliderStyle","marginBottom","saveButtonWrapperStyle","width","saveButtonMenuStyle","marginLeft","isFieSaveMounted","SaveButton","theme","dispatch","e","originalImage","f","resize","g","isLoadingGlobally","h","haveNotSavedChanges","i","feedback","j","t","k","adjustments","l","crop","m","config","n","onClose","o","closeAfterSave","p","onBeforeSave","q","onSave","r","forceToPngInEllipticalCrop","s","defaultSavedImageType","useCloudimage","u","moreSaveOptions","v","w","x","y","z","quality","A","B","C","D","E","includes","extension","F","duration","G","current","H","imageData","designState","type","Promise","AFTER_SAVE","I","setTimeout","J","Error","name","payload","message","K","L","ratio","toLowerCase","size","height","M","Array","isArray","map","key","concat","label","onClick","createElement","Fragment","className","color","menuPosition","menuItems","menuStyle","wrapperStyle","disabled","title","Icon","palette","isOpened","onCancel","onDone","doneLabel","cancelLabel","doneButtonColor","areButtonsDisabled","zIndex","value","onChange","changeFileName","target","placeholder","error","focusOnMount","annotation","min","max","changeQuality","parseInt","style","resizeImageFile","currentSize","hideResetButton","alignLeft"],"mappings":"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","sourcesContent":["import _extends from\"@babel/runtime/helpers/extends\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import React,{useEffect,useRef,useState}from\"react\";import MenuItem from\"@scaleflex/ui/core/menu-item\";import SaveAs from\"@scaleflex/icons/save-as\";import Label from\"@scaleflex/ui/core/label\";import{useStore,useTransformedImgData}from\"../../hooks\";import getFileFullName from\"../../utils/getFileFullName\";import{CLOSING_REASONS,ELLIPSE_CROP,SUPPORTED_IMAGE_TYPES}from\"../../utils/constants\";import{HIDE_LOADER,SET_FEEDBACK,SHOW_LOADER}from\"../../actions\";import Modal from\"../common/Modal\";import Slider from\"../common/Slider\";import restrictNumber from\"../../utils/restrictNumber\";import{Resize}from\"../tools/Resize\";import ButtonWithMenu from\"../common/ButtonWithMenu\";import{StyledFileExtensionSelect,StyledFileNameInput,StyledQualityWrapper,StyledResizeOnSave}from\"./Topbar.styled\";var sliderStyle={marginBottom:16},saveButtonWrapperStyle={width:67},saveButtonMenuStyle={marginLeft:12},isFieSaveMounted=!0,SaveButton=function(){var a=useStore(),b=useRef(),c=a.theme,d=a.dispatch,e=a.originalImage,f=a.resize,g=a.isLoadingGlobally,h=a.haveNotSavedChanges,i=a.feedback,j=a.t,k=a.adjustments;k=void 0===k?{}:k;var l=k.crop,m=a.config,n=m.onClose,o=m.closeAfterSave,p=m.onBeforeSave,q=m.onSave,r=m.forceToPngInEllipticalCrop,s=m.defaultSavedImageType,t=m.useCloudimage,u=m.moreSaveOptions,v=useState(!1),w=_slicedToArray(v,2),x=w[0],y=w[1],z=useState({quality:.92}),A=_slicedToArray(z,2),B=A[0],C=A[1],D=useTransformedImgData(),E=[\"jpeg\",\"jpg\",\"webp\"].includes(B.extension),F=0===i.duration,G=function(){isFieSaveMounted&&x&&(b.current=null,y(!1))},H=function(){var a=D(B,!1,!0),c=b.current||q,e=c(a.imageData,a.designState),f=function(){d({type:HIDE_LOADER})};e instanceof Promise?e[\"finally\"](f):f(),b.current=null,o&&n&&n(CLOSING_REASONS.AFTER_SAVE,h)},I=function(){d({type:SHOW_LOADER}),y(!1),setTimeout(H,3)},J=function(){var a=b.current||q;if(\"function\"!=typeof a)throw new Error(\"Please provide onSave function handler.\");return B.name&&B.extension?void I():void d({type:SET_FEEDBACK,payload:{feedback:{message:j(\"nameIsRequired\")}}})},K=function(){if(t){var a=D(B),c=b.current||q;return void c(a.imageData,a.designState)}return b.current||\"function\"!=typeof p||!1!==p(B)?void y(!0):void J()},L=function(a,c){if(\"function\"==typeof a)b.current=a,c();else throw new Error(\"onSave function callback is required as an argument to the passed function.\")};useEffect(function(){if(e&&(!B.name||!B.extension)){var a=getFileFullName(e.name,r&&l.ratio===ELLIPSE_CROP?\"png\":SUPPORTED_IMAGE_TYPES.includes(null===s||void 0===s?void 0:s.toLowerCase())&&s),b=a.name,c=a.extension;C(_objectSpread(_objectSpread({},B),{},{name:b,extension:c}))}},[e,x]),useEffect(function(){C(_objectSpread(_objectSpread({},B),{},{size:{width:f.width,height:f.height}}))},[f]),useEffect(function(){return isFieSaveMounted=!0,function(){isFieSaveMounted=!1}},[]);var M=Array.isArray(u)&&0<u.length?u.map(function(a,b){return _objectSpread(_objectSpread({},a),{},{key:\"\".concat(a.label||b,\"-option-key\"),onClick:\"function\"==typeof a.onClick?function(){return a.onClick(function(a){return L(a,K)},function(a){return L(a,I)})}:void 0})}):[];return React.createElement(React.Fragment,null,React.createElement(ButtonWithMenu,{className:\"FIE_topbar-save\",color:\"primary\",label:j(\"save\"),onClick:K,menuPosition:\"bottom\",menuItems:M,menuStyle:saveButtonMenuStyle,wrapperStyle:saveButtonWrapperStyle,disabled:g||F}),x&&React.createElement(Modal,{className:\"FIE_save-modal\",title:j(\"saveAsModalLabel\"),Icon:function Icon(a){return React.createElement(SaveAs,_extends({color:c.palette[\"accent-primary\"]},a))},isOpened:x,onCancel:G,onDone:J,doneLabel:j(\"save\"),cancelLabel:j(\"cancel\"),doneButtonColor:\"primary\",areButtonsDisabled:g,zIndex:11110},React.createElement(StyledFileNameInput,{className:\"FIE_save-file-name-input\",value:B.name,onChange:function changeFileName(a){var b=a.target.value;C(_objectSpread(_objectSpread({},B),{},{name:b}))},size:\"sm\",placeholder:j(\"name\"),error:!!B.name,focusOnMount:!0}),React.createElement(StyledFileExtensionSelect,{className:\"FIE_save-extension-selector\",onChange:function onChange(a){return C(_objectSpread(_objectSpread({},B),{},{extension:a}))},value:B.extension,placeholder:j(\"extension\"),size:\"sm\"},SUPPORTED_IMAGE_TYPES.map(function(a){return React.createElement(MenuItem,{key:a,value:a},a)})),E&&React.createElement(StyledQualityWrapper,{className:\"FIE_save-quality-wrapper\"},React.createElement(Label,null,j(\"quality\")),React.createElement(Slider,{annotation:\"%\",min:1,max:100,onChange:function changeQuality(a){C(_objectSpread(_objectSpread({},B),{},{quality:restrictNumber(a/100,.01,1)}))},value:parseInt(100*B.quality,10),width:\"100%\",style:sliderStyle})),React.createElement(StyledResizeOnSave,{className:\"FIE_save-resize-wrapper\"},React.createElement(Label,null,j(\"resize\")),React.createElement(Resize,{onChange:function resizeImageFile(a){C(_objectSpread(_objectSpread({},B),{},{size:_objectSpread(_objectSpread({},B.size),a)}))},currentSize:(null===B||void 0===B?void 0:B.size)||{},hideResetButton:!0,alignLeft:!0}))))};export default SaveButton;"]},"metadata":{},"sourceType":"module"}