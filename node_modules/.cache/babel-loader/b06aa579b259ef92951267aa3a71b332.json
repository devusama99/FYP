{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(a, b) {\n  var c = Object.keys(a);\n\n  if (Object.getOwnPropertySymbols) {\n    var d = Object.getOwnPropertySymbols(a);\n    b && (d = d.filter(function (b) {\n      return Object.getOwnPropertyDescriptor(a, b).enumerable;\n    })), c.push.apply(c, d);\n  }\n\n  return c;\n}\n\nfunction _objectSpread(a) {\n  for (var b, c = 1; c < arguments.length; c++) b = null == arguments[c] ? {} : arguments[c], c % 2 ? ownKeys(Object(b), !0).forEach(function (c) {\n    _defineProperty(a, c, b[c]);\n  }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(a, Object.getOwnPropertyDescriptors(b)) : ownKeys(Object(b)).forEach(function (c) {\n    Object.defineProperty(a, c, Object.getOwnPropertyDescriptor(b, c));\n  });\n\n  return a;\n}\n\nimport React, { memo, useCallback, useEffect, useMemo, useState, useRef } from \"react\";\nimport Konva from \"konva\";\nimport { useStrictMode } from \"react-konva\";\nimport { CHANGE_POINTER_ICON, CLEAR_ANNOTATIONS_SELECTIONS, ZOOM_CANVAS } from \"../../actions\";\nimport { DEFAULT_ZOOM_FACTOR, POINTER_ICONS, TABS_IDS, TOOLS_IDS } from \"../../utils/constants\";\nimport { useStore } from \"../../hooks\";\nimport { endTouchesZooming, zoomOnTouchesMove } from \"./touchZoomingEvents\";\nimport { StyledCanvasNode } from \"./MainCanvas.styled\";\n\nvar ZOOM_DELTA_TO_SCALE_CONVERT_FACTOR = .006,\n    CanvasNode = function (a) {\n  var b = a.children;\n  useStrictMode(!0);\n  var c = useRef(),\n      d = useStore(),\n      f = d.dispatch,\n      g = d.pointerCssIcon,\n      h = d.tabId,\n      i = d.toolId,\n      j = d.canvasWidth,\n      k = d.canvasHeight,\n      l = d.canvasScale,\n      m = d.selectionsIds,\n      n = void 0 === m ? [] : m,\n      o = d.zoom,\n      p = void 0 === o ? {} : o,\n      q = d.config,\n      r = q.previewPixelRatio,\n      s = q.disableZooming;\n  Konva.pixelRatio = r;\n\n  var t = DEFAULT_ZOOM_FACTOR,\n      u = !s && i !== TOOLS_IDS.CROP,\n      v = useState(h !== TABS_IDS.ANNOTATE && h !== TABS_IDS.WATERMARK && p.factor > t),\n      w = _slicedToArray(v, 2),\n      x = w[0],\n      y = w[1],\n      z = useMemo(function () {\n    return {\n      cursor: g === POINTER_ICONS.DEFAULT && h === TABS_IDS.ANNOTATE ? POINTER_ICONS.DRAW : g\n    };\n  }, [h, g]),\n      A = function (a) {\n    f({\n      type: ZOOM_CANVAS,\n      payload: a\n    });\n  },\n      B = useCallback(function (a) {\n    var b, c;\n    a.evt.preventDefault(), null === (b = (c = a.currentTarget).container) || void 0 === b ? void 0 : b.call(c).focus(), a.target instanceof Konva.Stage && 0 < n.length && f({\n      type: CLEAR_ANNOTATIONS_SELECTIONS\n    });\n  }, [n]),\n      C = function () {\n    return y(h !== TABS_IDS.ANNOTATE || h === TABS_IDS.WATERMARK);\n  },\n      D = function (a) {\n    (\"Space\" === a.code || \"Control\" === a.key) && !a.repeat && p.factor > t && u && (a.preventDefault(), y(!0), f({\n      type: CHANGE_POINTER_ICON,\n      payload: {\n        pointerCssIcon: POINTER_ICONS.DRAG\n      }\n    }));\n  },\n      E = function (a) {\n    \"Space\" === a.code && (a.preventDefault(), C());\n  },\n      F = function () {\n    c.current && c.current.container().focus();\n  };\n\n  useEffect(function () {\n    f({\n      type: CHANGE_POINTER_ICON,\n      payload: {\n        pointerCssIcon: POINTER_ICONS[x ? \"DRAG\" : \"DEFAULT\"]\n      }\n    });\n  }, [x]), useEffect(function () {\n    y(h !== TABS_IDS.ANNOTATE && h !== TABS_IDS.WATERMARK && p.factor > t);\n    var a;\n    return c.current && (a = c.current.container(), a.addEventListener(\"mouseenter\", F), a.addEventListener(\"keydown\", D), a.addEventListener(\"keyup\", E)), function () {\n      a && (a.removeEventListener(\"mouseenter\", F), a.removeEventListener(\"keydown\", D), a.removeEventListener(\"keyup\", E));\n    };\n  }, [h, p.factor, t]);\n  var G = l * (u && p.factor || t);\n  return React.createElement(StyledCanvasNode, {\n    className: \"FIE_canvas-node\",\n    tabIndex: -1,\n    ref: c,\n    width: j,\n    height: k,\n    scaleX: G,\n    scaleY: G,\n    x: u && p.x || null,\n    y: u && p.y || null,\n    zoomFactor: u && p.factor || t,\n    onWheel: u ? function handleZoom(a) {\n      a.evt.preventDefault();\n      var b = (p.factor || t) + a.evt.deltaY * -ZOOM_DELTA_TO_SCALE_CONVERT_FACTOR,\n          c = a.currentTarget.getPointerPosition();\n      A(_objectSpread(_objectSpread({}, c), {}, {\n        factor: b\n      }));\n    } : void 0,\n    onTap: B,\n    onClick: B,\n    onTouchMove: u ? function (a) {\n      return zoomOnTouchesMove(a, A);\n    } : void 0,\n    onDragStart: function preventDraggingIfMultiTouches(a) {\n      var b;\n      1 < (null === (b = a.evt.touches) || void 0 === b ? void 0 : b.length) && y(!1);\n    },\n    onTouchEnd: u ? function endTouchesZoomingEnablePanning() {\n      endTouchesZooming(C);\n    } : void 0,\n    dragBoundFunc: function dragBoundFunc(a) {\n      var b = Math.min(0, Math.max(a.x, j * (1 - p.factor))),\n          c = Math.min(0, Math.max(a.y, k * (1 - p.factor)));\n      return {\n        x: b,\n        y: c\n      };\n    },\n    draggable: u && x,\n    onDragEnd: function handleCanvasDragEnd(a) {\n      a.currentTarget.draggable() && \"stage\" === a.target.nodeType.toLowerCase() && u && x && A({\n        factor: p.factor,\n        x: a.target.x(),\n        y: a.target.y(),\n        preparedDimensions: !0\n      });\n    },\n    style: z\n  }, b);\n};\n\nexport default memo(CanvasNode);","map":{"version":3,"sources":["/Users/devusama/Work/FYP_FrontEnd/node_modules/react-filerobot-image-editor/lib/components/MainCanvas/CanvasNode.js"],"names":["_defineProperty","_slicedToArray","ownKeys","a","b","c","Object","keys","getOwnPropertySymbols","d","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","React","memo","useCallback","useEffect","useMemo","useState","useRef","Konva","useStrictMode","CHANGE_POINTER_ICON","CLEAR_ANNOTATIONS_SELECTIONS","ZOOM_CANVAS","DEFAULT_ZOOM_FACTOR","POINTER_ICONS","TABS_IDS","TOOLS_IDS","useStore","endTouchesZooming","zoomOnTouchesMove","StyledCanvasNode","ZOOM_DELTA_TO_SCALE_CONVERT_FACTOR","CanvasNode","children","f","dispatch","g","pointerCssIcon","h","tabId","i","toolId","j","canvasWidth","k","canvasHeight","l","canvasScale","m","selectionsIds","n","o","zoom","p","q","config","r","previewPixelRatio","s","disableZooming","pixelRatio","t","u","CROP","v","ANNOTATE","WATERMARK","factor","w","x","y","z","cursor","DEFAULT","DRAW","A","type","payload","B","evt","preventDefault","currentTarget","container","call","focus","target","Stage","C","D","code","key","repeat","DRAG","E","F","current","addEventListener","removeEventListener","G","createElement","className","tabIndex","ref","width","height","scaleX","scaleY","zoomFactor","onWheel","handleZoom","deltaY","getPointerPosition","onTap","onClick","onTouchMove","onDragStart","preventDraggingIfMultiTouches","touches","onTouchEnd","endTouchesZoomingEnablePanning","dragBoundFunc","Math","min","max","draggable","onDragEnd","handleCanvasDragEnd","nodeType","toLowerCase","preparedDimensions","style"],"mappings":"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","sourcesContent":["import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import React,{memo,useCallback,useEffect,useMemo,useState,useRef}from\"react\";import Konva from\"konva\";import{useStrictMode}from\"react-konva\";import{CHANGE_POINTER_ICON,CLEAR_ANNOTATIONS_SELECTIONS,ZOOM_CANVAS}from\"../../actions\";import{DEFAULT_ZOOM_FACTOR,POINTER_ICONS,TABS_IDS,TOOLS_IDS}from\"../../utils/constants\";import{useStore}from\"../../hooks\";import{endTouchesZooming,zoomOnTouchesMove}from\"./touchZoomingEvents\";import{StyledCanvasNode}from\"./MainCanvas.styled\";var ZOOM_DELTA_TO_SCALE_CONVERT_FACTOR=.006,CanvasNode=function(a){var b=a.children;useStrictMode(!0);var c=useRef(),d=useStore(),f=d.dispatch,g=d.pointerCssIcon,h=d.tabId,i=d.toolId,j=d.canvasWidth,k=d.canvasHeight,l=d.canvasScale,m=d.selectionsIds,n=void 0===m?[]:m,o=d.zoom,p=void 0===o?{}:o,q=d.config,r=q.previewPixelRatio,s=q.disableZooming;Konva.pixelRatio=r;var t=DEFAULT_ZOOM_FACTOR,u=!s&&i!==TOOLS_IDS.CROP,v=useState(h!==TABS_IDS.ANNOTATE&&h!==TABS_IDS.WATERMARK&&p.factor>t),w=_slicedToArray(v,2),x=w[0],y=w[1],z=useMemo(function(){return{cursor:g===POINTER_ICONS.DEFAULT&&h===TABS_IDS.ANNOTATE?POINTER_ICONS.DRAW:g}},[h,g]),A=function(a){f({type:ZOOM_CANVAS,payload:a})},B=useCallback(function(a){var b,c;a.evt.preventDefault(),null===(b=(c=a.currentTarget).container)||void 0===b?void 0:b.call(c).focus(),a.target instanceof Konva.Stage&&0<n.length&&f({type:CLEAR_ANNOTATIONS_SELECTIONS})},[n]),C=function(){return y(h!==TABS_IDS.ANNOTATE||h===TABS_IDS.WATERMARK)},D=function(a){(\"Space\"===a.code||\"Control\"===a.key)&&!a.repeat&&p.factor>t&&u&&(a.preventDefault(),y(!0),f({type:CHANGE_POINTER_ICON,payload:{pointerCssIcon:POINTER_ICONS.DRAG}}))},E=function(a){\"Space\"===a.code&&(a.preventDefault(),C())},F=function(){c.current&&c.current.container().focus()};useEffect(function(){f({type:CHANGE_POINTER_ICON,payload:{pointerCssIcon:POINTER_ICONS[x?\"DRAG\":\"DEFAULT\"]}})},[x]),useEffect(function(){y(h!==TABS_IDS.ANNOTATE&&h!==TABS_IDS.WATERMARK&&p.factor>t);var a;return c.current&&(a=c.current.container(),a.addEventListener(\"mouseenter\",F),a.addEventListener(\"keydown\",D),a.addEventListener(\"keyup\",E)),function(){a&&(a.removeEventListener(\"mouseenter\",F),a.removeEventListener(\"keydown\",D),a.removeEventListener(\"keyup\",E))}},[h,p.factor,t]);var G=l*(u&&p.factor||t);return React.createElement(StyledCanvasNode,{className:\"FIE_canvas-node\",tabIndex:-1,ref:c,width:j,height:k,scaleX:G,scaleY:G,x:u&&p.x||null,y:u&&p.y||null,zoomFactor:u&&p.factor||t,onWheel:u?function handleZoom(a){a.evt.preventDefault();var b=(p.factor||t)+a.evt.deltaY*-ZOOM_DELTA_TO_SCALE_CONVERT_FACTOR,c=a.currentTarget.getPointerPosition();A(_objectSpread(_objectSpread({},c),{},{factor:b}))}:void 0,onTap:B,onClick:B,onTouchMove:u?function(a){return zoomOnTouchesMove(a,A)}:void 0,onDragStart:function preventDraggingIfMultiTouches(a){var b;1<(null===(b=a.evt.touches)||void 0===b?void 0:b.length)&&y(!1)},onTouchEnd:u?function endTouchesZoomingEnablePanning(){endTouchesZooming(C)}:void 0,dragBoundFunc:function dragBoundFunc(a){var b=Math.min(0,Math.max(a.x,j*(1-p.factor))),c=Math.min(0,Math.max(a.y,k*(1-p.factor)));return{x:b,y:c}},draggable:u&&x,onDragEnd:function handleCanvasDragEnd(a){a.currentTarget.draggable()&&\"stage\"===a.target.nodeType.toLowerCase()&&u&&x&&A({factor:p.factor,x:a.target.x(),y:a.target.y(),preparedDimensions:!0})},style:z},b)};export default memo(CanvasNode);"]},"metadata":{},"sourceType":"module"}