{"ast":null,"code":"import _typeof from \"@babel/runtime/helpers/typeof\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(a, b) {\n  var c = Object.keys(a);\n\n  if (Object.getOwnPropertySymbols) {\n    var d = Object.getOwnPropertySymbols(a);\n    b && (d = d.filter(function (b) {\n      return Object.getOwnPropertyDescriptor(a, b).enumerable;\n    })), c.push.apply(c, d);\n  }\n\n  return c;\n}\n\nfunction _objectSpread(a) {\n  for (var b, c = 1; c < arguments.length; c++) b = null == arguments[c] ? {} : arguments[c], c % 2 ? ownKeys(Object(b), !0).forEach(function (c) {\n    _defineProperty(a, c, b[c]);\n  }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(a, Object.getOwnPropertyDescriptors(b)) : ownKeys(Object(b)).forEach(function (c) {\n    Object.defineProperty(a, c, Object.getOwnPropertyDescriptor(b, c));\n  });\n\n  return a;\n}\n\nimport React, { memo, useCallback, useEffect, useState, useRef } from \"react\";\nimport MainCanvas from \"../MainCanvas\";\nimport { ROOT_CONTAINER_CLASS_NAME } from \"../../utils/constants\";\nimport Topbar from \"../Topbar\";\nimport Tabs from \"../Tabs\";\nimport ToolsBar from \"../ToolsBar\";\nimport { HIDE_LOADER, SET_FEEDBACK, SET_ORIGINAL_IMAGE, SHOW_LOADER, UPDATE_STATE } from \"../../actions\";\nimport FeedbackPopup from \"../FeedbackPopup\";\nimport loadImage from \"../../utils/loadImage\";\nimport { usePhoneScreen, useResizeObserver, useStore, useTransformedImgData } from \"../../hooks\";\nimport Spinner from \"../common/Spinner\";\nimport { getBackendTranslations } from \"../../utils/translator\";\nimport cloudimageQueryToDesignState from \"../../utils/cloudimageQueryToDesignState\";\nimport finetunesStrsToClasses from \"../../utils/finetunesStrsToClasses\";\nimport filterStrToClass from \"../../utils/filterStrToClass\";\nimport isSameImage from \"../../utils/isSameImage\";\nimport { StyledAppWrapper, StyledMainContent, StyledCanvasAndTools, StyledPhoneToolsAndTabs } from \"./App.styled\";\n\nvar App = function () {\n  var a = useStore(),\n      b = a.config,\n      c = a.isLoadingGlobally,\n      d = a.haveNotSavedChanges,\n      e = a.dispatch,\n      f = a.originalImage,\n      g = a.shownImageDimensions,\n      h = a.t,\n      i = a.feedback,\n      j = void 0 === i ? {} : i,\n      k = b.loadableDesignState,\n      l = b.useCloudimage,\n      m = b.cloudimage,\n      n = b.source,\n      o = b.avoidChangesNotSavedAlertOnLeave,\n      p = b.useBackendTranslations,\n      q = b.translations,\n      r = b.language,\n      s = b.defaultSavedImageName,\n      t = b.observePluginContainerSize,\n      u = b.showCanvasOnly,\n      v = b.getCurrentImgDataFnRef,\n      w = b.updateStateFnRef,\n      x = useResizeObserver(),\n      y = _slicedToArray(x, 2),\n      z = y[0],\n      A = y[1],\n      B = useState({\n    width: void 0,\n    height: void 0\n  }),\n      C = _slicedToArray(B, 2),\n      D = C[0],\n      E = C[1],\n      F = usePhoneScreen(),\n      G = useRef(null),\n      H = useRef(!0),\n      I = useRef(!1),\n      J = useRef(null),\n      K = useRef(d),\n      L = useTransformedImgData(),\n      M = useCallback(function (a) {\n    e({\n      type: SET_ORIGINAL_IMAGE,\n      payload: {\n        originalImage: a\n      }\n    });\n  }, []),\n      N = useCallback(function (a) {\n    e({\n      type: SET_FEEDBACK,\n      payload: {\n        feedback: {\n          message: a.message || a,\n          duration: 0\n        }\n      }\n    });\n  }, []),\n      O = function (a) {\n    return new Promise(function (b) {\n      var c = (null === a || void 0 === a ? void 0 : a.src) || a;\n      if (J.current === c || !c && f || isSameImage(c, f)) return void (J.current || b());\n\n      var d = function () {\n        J.current = null, b();\n      };\n\n      J.current = c, \"string\" == typeof a ? loadImage(a, s).then(M)[\"catch\"](N)[\"finally\"](d) : a instanceof HTMLImageElement ? (M(a), d()) : (N(h(\"invalidImageError\")), d());\n    });\n  },\n      P = function (a) {\n    K.current && (a.preventDefault(), a.returnValue = \"\");\n  },\n      Q = function () {\n    var a = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : function () {\n      return [];\n    };\n    return e({\n      type: SHOW_LOADER\n    }), Promise.all(a())[\"finally\"](function () {\n      e({\n        type: HIDE_LOADER\n      });\n    });\n  },\n      R = function () {\n    k && 0 < Object.keys(k).length && e({\n      type: UPDATE_STATE,\n      payload: _objectSpread(_objectSpread({}, k), {}, {\n        finetunes: finetunesStrsToClasses(null === k || void 0 === k ? void 0 : k.finetunes),\n        filter: filterStrToClass(null === k || void 0 === k ? void 0 : k.filter)\n      })\n    });\n  };\n\n  return useEffect(function () {\n    H.current || !n || isSameImage(n, f) || (I.current = !1, Q(function () {\n      return [O(n)];\n    }));\n  }, [n]), useEffect(function () {\n    if (!H.current) {\n      var a = null === k || void 0 === k ? void 0 : k.imgSrc;\n      a && !isSameImage(a, f) ? Q(function () {\n        return [O(a).then(R)];\n      }) : R();\n    }\n  }, [k]), useEffect(function () {\n    0 < Object.keys(g || {}).length && !Object.keys(g).some(function (a) {\n      return !g[a];\n    }) && f && l && null !== m && void 0 !== m && m.loadableQuery && !I.current && (e({\n      type: UPDATE_STATE,\n      payload: cloudimageQueryToDesignState(m.loadableQuery, g, f)\n    }), I.current = !0);\n  }, [g, f, l, m]), useEffect(function () {\n    var a = !1;\n    return t && G.current ? z(G.current.parentNode, function (a) {\n      var b = a.width,\n          c = a.height;\n      return E({\n        width: b,\n        height: c\n      });\n    }) : D.width && D.height && !a && E({\n      width: void 0,\n      height: void 0\n    }), function () {\n      t && G.current && A(G.current), a = !0;\n    };\n  }, [t]), useEffect(function () {\n    return Q(function initialRequestsPromisesFn() {\n      return [O((null === k || void 0 === k ? void 0 : k.imgSrc) || n)].concat(_toConsumableArray(p ? [getBackendTranslations(r, q)] : []));\n    }), H.current = !1, window && !o && window.addEventListener(\"beforeunload\", P), function () {\n      window && !o && window.removeEventListener(\"beforeunload\", P);\n    };\n  }, []), useEffect(function () {\n    w && \"object\" === _typeof(w) && (w.current = function (a) {\n      e({\n        type: UPDATE_STATE,\n        payload: a\n      });\n    });\n  }, [w, e]), useEffect(function () {\n    v && \"object\" === _typeof(v) && (v.current = L);\n  }, [L]), useEffect(function () {\n    K.current = d;\n  }, [d]), React.createElement(StyledAppWrapper, {\n    className: ROOT_CONTAINER_CLASS_NAME,\n    \"data-phone\": F,\n    ref: G,\n    $size: D\n  }, c && React.createElement(Spinner, {\n    label: h(\"loading\")\n  }), !u && React.createElement(Topbar, null), f && 0 !== j.duration && React.createElement(StyledMainContent, {\n    className: \"FIE_main-container\"\n  }, !F && !u && React.createElement(Tabs, null), React.createElement(StyledCanvasAndTools, {\n    className: \"FIE_editor-content\"\n  }, React.createElement(MainCanvas, null), !u && (F ? React.createElement(StyledPhoneToolsAndTabs, {\n    className: \"FIE_phone-tools-tabs-wrapper\"\n  }, React.createElement(ToolsBar, null), React.createElement(Tabs, null)) : React.createElement(ToolsBar, null)))), React.createElement(FeedbackPopup, null));\n};\n\nexport default memo(App);","map":{"version":3,"sources":["/Users/devusama/Work/FYP_FrontEnd/node_modules/react-filerobot-image-editor/lib/components/App/index.js"],"names":["_typeof","_toConsumableArray","_defineProperty","_slicedToArray","ownKeys","a","b","c","Object","keys","getOwnPropertySymbols","d","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","React","memo","useCallback","useEffect","useState","useRef","MainCanvas","ROOT_CONTAINER_CLASS_NAME","Topbar","Tabs","ToolsBar","HIDE_LOADER","SET_FEEDBACK","SET_ORIGINAL_IMAGE","SHOW_LOADER","UPDATE_STATE","FeedbackPopup","loadImage","usePhoneScreen","useResizeObserver","useStore","useTransformedImgData","Spinner","getBackendTranslations","cloudimageQueryToDesignState","finetunesStrsToClasses","filterStrToClass","isSameImage","StyledAppWrapper","StyledMainContent","StyledCanvasAndTools","StyledPhoneToolsAndTabs","App","config","isLoadingGlobally","haveNotSavedChanges","e","dispatch","f","originalImage","g","shownImageDimensions","h","t","i","feedback","j","k","loadableDesignState","l","useCloudimage","m","cloudimage","n","source","o","avoidChangesNotSavedAlertOnLeave","p","useBackendTranslations","q","translations","r","language","s","defaultSavedImageName","observePluginContainerSize","u","showCanvasOnly","v","getCurrentImgDataFnRef","w","updateStateFnRef","x","y","z","A","B","width","height","C","D","E","F","G","H","I","J","K","L","M","type","payload","N","message","duration","O","Promise","src","current","then","HTMLImageElement","P","preventDefault","returnValue","Q","all","R","finetunes","imgSrc","some","loadableQuery","parentNode","initialRequestsPromisesFn","concat","window","addEventListener","removeEventListener","createElement","className","ref","$size","label"],"mappings":"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","sourcesContent":["import _typeof from\"@babel/runtime/helpers/typeof\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import React,{memo,useCallback,useEffect,useState,useRef}from\"react\";import MainCanvas from\"../MainCanvas\";import{ROOT_CONTAINER_CLASS_NAME}from\"../../utils/constants\";import Topbar from\"../Topbar\";import Tabs from\"../Tabs\";import ToolsBar from\"../ToolsBar\";import{HIDE_LOADER,SET_FEEDBACK,SET_ORIGINAL_IMAGE,SHOW_LOADER,UPDATE_STATE}from\"../../actions\";import FeedbackPopup from\"../FeedbackPopup\";import loadImage from\"../../utils/loadImage\";import{usePhoneScreen,useResizeObserver,useStore,useTransformedImgData}from\"../../hooks\";import Spinner from\"../common/Spinner\";import{getBackendTranslations}from\"../../utils/translator\";import cloudimageQueryToDesignState from\"../../utils/cloudimageQueryToDesignState\";import finetunesStrsToClasses from\"../../utils/finetunesStrsToClasses\";import filterStrToClass from\"../../utils/filterStrToClass\";import isSameImage from\"../../utils/isSameImage\";import{StyledAppWrapper,StyledMainContent,StyledCanvasAndTools,StyledPhoneToolsAndTabs}from\"./App.styled\";var App=function(){var a=useStore(),b=a.config,c=a.isLoadingGlobally,d=a.haveNotSavedChanges,e=a.dispatch,f=a.originalImage,g=a.shownImageDimensions,h=a.t,i=a.feedback,j=void 0===i?{}:i,k=b.loadableDesignState,l=b.useCloudimage,m=b.cloudimage,n=b.source,o=b.avoidChangesNotSavedAlertOnLeave,p=b.useBackendTranslations,q=b.translations,r=b.language,s=b.defaultSavedImageName,t=b.observePluginContainerSize,u=b.showCanvasOnly,v=b.getCurrentImgDataFnRef,w=b.updateStateFnRef,x=useResizeObserver(),y=_slicedToArray(x,2),z=y[0],A=y[1],B=useState({width:void 0,height:void 0}),C=_slicedToArray(B,2),D=C[0],E=C[1],F=usePhoneScreen(),G=useRef(null),H=useRef(!0),I=useRef(!1),J=useRef(null),K=useRef(d),L=useTransformedImgData(),M=useCallback(function(a){e({type:SET_ORIGINAL_IMAGE,payload:{originalImage:a}})},[]),N=useCallback(function(a){e({type:SET_FEEDBACK,payload:{feedback:{message:a.message||a,duration:0}}})},[]),O=function(a){return new Promise(function(b){var c=(null===a||void 0===a?void 0:a.src)||a;if(J.current===c||!c&&f||isSameImage(c,f))return void(J.current||b());var d=function(){J.current=null,b()};J.current=c,\"string\"==typeof a?loadImage(a,s).then(M)[\"catch\"](N)[\"finally\"](d):a instanceof HTMLImageElement?(M(a),d()):(N(h(\"invalidImageError\")),d())})},P=function(a){K.current&&(a.preventDefault(),a.returnValue=\"\")},Q=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return[]};return e({type:SHOW_LOADER}),Promise.all(a())[\"finally\"](function(){e({type:HIDE_LOADER})})},R=function(){k&&0<Object.keys(k).length&&e({type:UPDATE_STATE,payload:_objectSpread(_objectSpread({},k),{},{finetunes:finetunesStrsToClasses(null===k||void 0===k?void 0:k.finetunes),filter:filterStrToClass(null===k||void 0===k?void 0:k.filter)})})};return useEffect(function(){H.current||!n||isSameImage(n,f)||(I.current=!1,Q(function(){return[O(n)]}))},[n]),useEffect(function(){if(!H.current){var a=null===k||void 0===k?void 0:k.imgSrc;a&&!isSameImage(a,f)?Q(function(){return[O(a).then(R)]}):R()}},[k]),useEffect(function(){0<Object.keys(g||{}).length&&!Object.keys(g).some(function(a){return!g[a]})&&f&&l&&null!==m&&void 0!==m&&m.loadableQuery&&!I.current&&(e({type:UPDATE_STATE,payload:cloudimageQueryToDesignState(m.loadableQuery,g,f)}),I.current=!0)},[g,f,l,m]),useEffect(function(){var a=!1;return t&&G.current?z(G.current.parentNode,function(a){var b=a.width,c=a.height;return E({width:b,height:c})}):D.width&&D.height&&!a&&E({width:void 0,height:void 0}),function(){t&&G.current&&A(G.current),a=!0}},[t]),useEffect(function(){return Q(function initialRequestsPromisesFn(){return[O((null===k||void 0===k?void 0:k.imgSrc)||n)].concat(_toConsumableArray(p?[getBackendTranslations(r,q)]:[]))}),H.current=!1,window&&!o&&window.addEventListener(\"beforeunload\",P),function(){window&&!o&&window.removeEventListener(\"beforeunload\",P)}},[]),useEffect(function(){w&&\"object\"===_typeof(w)&&(w.current=function(a){e({type:UPDATE_STATE,payload:a})})},[w,e]),useEffect(function(){v&&\"object\"===_typeof(v)&&(v.current=L)},[L]),useEffect(function(){K.current=d},[d]),React.createElement(StyledAppWrapper,{className:ROOT_CONTAINER_CLASS_NAME,\"data-phone\":F,ref:G,$size:D},c&&React.createElement(Spinner,{label:h(\"loading\")}),!u&&React.createElement(Topbar,null),f&&0!==j.duration&&React.createElement(StyledMainContent,{className:\"FIE_main-container\"},!F&&!u&&React.createElement(Tabs,null),React.createElement(StyledCanvasAndTools,{className:\"FIE_editor-content\"},React.createElement(MainCanvas,null),!u&&(F?React.createElement(StyledPhoneToolsAndTabs,{className:\"FIE_phone-tools-tabs-wrapper\"},React.createElement(ToolsBar,null),React.createElement(Tabs,null)):React.createElement(ToolsBar,null)))),React.createElement(FeedbackPopup,null))};export default memo(App);"]},"metadata":{},"sourceType":"module"}