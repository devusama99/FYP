{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(a, b) {\n  var c = Object.keys(a);\n\n  if (Object.getOwnPropertySymbols) {\n    var d = Object.getOwnPropertySymbols(a);\n    b && (d = d.filter(function (b) {\n      return Object.getOwnPropertyDescriptor(a, b).enumerable;\n    })), c.push.apply(c, d);\n  }\n\n  return c;\n}\n\nfunction _objectSpread(a) {\n  for (var b, c = 1; c < arguments.length; c++) b = null == arguments[c] ? {} : arguments[c], c % 2 ? ownKeys(Object(b), !0).forEach(function (c) {\n    _defineProperty(a, c, b[c]);\n  }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(a, Object.getOwnPropertyDescriptors(b)) : ownKeys(Object(b)).forEach(function (c) {\n    Object.defineProperty(a, c, Object.getOwnPropertyDescriptor(b, c));\n  });\n\n  return a;\n}\n\nimport React, { useEffect, useRef } from \"react\";\nimport { Ellipse, Image, Rect, Transformer } from \"react-konva\";\nimport Konva from \"konva\";\nimport { useStore } from \"../../../hooks\";\nimport { SET_CROP, SET_FEEDBACK } from \"../../../actions\";\nimport { CUSTOM_CROP, ELLIPSE_CROP, FEEDBACK_STATUSES, ORIGINAL_CROP, TOOLS_IDS } from \"../../../utils/constants\";\nimport { boundDragging, boundResizing } from \"./cropAreaBounding\";\n\nvar CropTransformer = function () {\n  var a = useStore(),\n      b = a.dispatch,\n      c = a.theme,\n      d = a.designLayer,\n      e = a.originalImage,\n      f = a.shownImageDimensions,\n      g = a.adjustments;\n  g = void 0 === g ? {} : g;\n\n  var h = g.crop,\n      i = void 0 === h ? {} : h,\n      j = g.isFlippedX,\n      k = g.isFlippedY,\n      l = a.resize,\n      m = void 0 === l ? {} : l,\n      n = a.config,\n      o = a.t,\n      p = useRef(),\n      q = useRef(),\n      r = useRef(),\n      s = useRef(),\n      t = n[TOOLS_IDS.CROP],\n      u = i.ratio || t.ratio,\n      v = u === CUSTOM_CROP,\n      w = u === ELLIPSE_CROP,\n      z = function () {\n    return u === ORIGINAL_CROP ? e.width / e.height : u;\n  },\n      A = function (a, c) {\n    var d = a.width,\n        e = a.height,\n        g = a.x,\n        h = a.y,\n        l = {\n      x: j ? f.width - g - d : g,\n      y: k ? f.height - h - e : h,\n      width: d,\n      height: e\n    },\n        n = i.width >= m.width && i.height >= m.height;\n    m.width && m.height && (d < m.width || e < m.height) && n && b({\n      type: SET_FEEDBACK,\n      payload: {\n        feedback: {\n          message: o(\"cropSizeLowerThanResizedWarning\"),\n          status: FEEDBACK_STATUSES.WARNING\n        }\n      }\n    }), b({\n      type: SET_CROP,\n      payload: _objectSpread(_objectSpread(_objectSpread({}, i), l), {}, {\n        dismissHistory: c\n      })\n    });\n  },\n      B = function (a, b) {\n    var c, d;\n    q.current && p.current && q.current.nodes([p.current]);\n    var e = s.current,\n        f = {\n      width: a,\n      height: b,\n      x: null !== (c = i.x) && void 0 !== c ? c : 0,\n      y: null !== (d = i.y) && void 0 !== d ? d : 0\n    };\n    A(boundResizing(f, f, _objectSpread(_objectSpread({}, e), {}, {\n      abstractX: 0,\n      abstractY: 0\n    }), !(v || w) && z(), t), !0);\n  };\n\n  if (useEffect(function () {\n    return d && q.current && p.current && (r.current && r.current.cache(), q.current.nodes([p.current])), function () {\n      r.current && r.current.clearCache();\n    };\n  }, [d, e, f]), useEffect(function () {\n    if (s.current) {\n      var a,\n          b,\n          c = s.current;\n      B(null !== (a = i.width) && void 0 !== a ? a : c.width, null !== (b = i.height) && void 0 !== b ? b : c.height);\n    }\n  }, [u]), useEffect(function () {\n    q.current && p.current && s.current && i.width && i.height && B(i.width, i.height);\n  }, [t, f.width, f.height]), useEffect(function () {\n    f && (s.current = f);\n  }, [f]), !d) return null;\n\n  var C,\n      D = v || w ? void 0 : [\"top-left\", \"bottom-left\", \"top-right\", \"bottom-right\"],\n      E = function (a) {\n    var b = !!(1 < arguments.length && void 0 !== arguments[1]) && arguments[1];\n    a.target && A({\n      width: a.target.width() * a.target.scaleX(),\n      height: a.target.height() * a.target.scaleY(),\n      x: a.target.x(),\n      y: a.target.y()\n    }, b);\n  };\n\n  if (!i.width && !i.height) {\n    var F = 1 > f.scaledBy ? f.scaledBy : 1,\n        G = _objectSpread(_objectSpread({}, f), {}, {\n      width: f.width / F,\n      height: f.height / F\n    });\n\n    C = boundResizing(G, _objectSpread(_objectSpread({}, G), {}, {\n      x: 0,\n      y: 0\n    }), _objectSpread(_objectSpread({}, G), {}, {\n      abstractX: 0,\n      abstractY: 0\n    }), !(v || w) && z(), t);\n  } else C = i;\n\n  var H = C,\n      I = H.x,\n      J = void 0 === I ? 0 : I,\n      x = H.y,\n      K = void 0 === x ? 0 : x,\n      y = H.width,\n      L = H.height,\n      M = {\n    x: j ? f.width - J - y : J,\n    y: k ? f.height - K - L : K,\n    ref: p,\n    fill: \"#FFFFFF\",\n    scaleX: 1,\n    scaleY: 1,\n    globalCompositeOperation: \"destination-out\",\n    onDragEnd: E,\n    onDragMove: function limitDragging(a) {\n      var b = a.target;\n      b.setAttrs(boundDragging(b.attrs, s.current));\n    },\n    onTransformEnd: E,\n    draggable: !0\n  };\n  return React.createElement(React.Fragment, null, React.createElement(Image, {\n    image: e,\n    x: j ? f.width : 0,\n    y: k ? f.height : 0,\n    width: f.width,\n    height: f.height,\n    filters: [Konva.Filters.Blur, Konva.Filters.Brighten],\n    blurRadius: 10,\n    brightness: -.3,\n    scaleX: j ? -1 : 1,\n    scaleY: k ? -1 : 1,\n    ref: r\n  }), w ? React.createElement(Ellipse, _extends({}, M, {\n    radiusX: y / 2,\n    radiusY: L / 2,\n    offset: {\n      x: -y / 2,\n      y: -L / 2\n    }\n  })) : React.createElement(Rect, _extends({}, M, {\n    width: y,\n    height: L\n  })), React.createElement(Transformer, {\n    centeredScaling: !1,\n    flipEnabled: !1,\n    rotateEnabled: !1,\n    nodes: p.current ? [p.current] : [],\n    anchorSize: 14,\n    anchorCornerRadius: 7,\n    enabledAnchors: D,\n    ignoreStroke: !1,\n    anchorStroke: c.palette[\"accent-primary\"],\n    anchorFill: c.palette[\"access-primary\"],\n    anchorStrokeWidth: 2,\n    borderStroke: c.palette[\"accent-primary\"],\n    borderStrokeWidth: 2,\n    borderDash: [4],\n    keepRatio: !v || !w,\n    ref: q,\n    boundBoxFunc: function boundBoxFunc(a, b) {\n      return boundResizing(a, b, s.current, !(v || w) && z(), t);\n    }\n  }));\n};\n\nexport default CropTransformer;","map":{"version":3,"sources":["/Users/devusama/Work/FYP_FrontEnd/node_modules/react-filerobot-image-editor/lib/components/Layers/TransformersLayer/CropTransformer.js"],"names":["_extends","_defineProperty","ownKeys","a","b","c","Object","keys","getOwnPropertySymbols","d","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","React","useEffect","useRef","Ellipse","Image","Rect","Transformer","Konva","useStore","SET_CROP","SET_FEEDBACK","CUSTOM_CROP","ELLIPSE_CROP","FEEDBACK_STATUSES","ORIGINAL_CROP","TOOLS_IDS","boundDragging","boundResizing","CropTransformer","dispatch","theme","designLayer","e","originalImage","f","shownImageDimensions","g","adjustments","h","crop","i","j","isFlippedX","k","isFlippedY","l","resize","m","n","config","o","t","p","q","r","s","CROP","u","ratio","v","w","z","width","height","A","x","y","type","payload","feedback","message","status","WARNING","dismissHistory","B","current","nodes","abstractX","abstractY","cache","clearCache","C","D","E","target","scaleX","scaleY","F","scaledBy","G","H","I","J","K","L","M","ref","fill","globalCompositeOperation","onDragEnd","onDragMove","limitDragging","setAttrs","attrs","onTransformEnd","draggable","createElement","Fragment","image","filters","Filters","Blur","Brighten","blurRadius","brightness","radiusX","radiusY","offset","centeredScaling","flipEnabled","rotateEnabled","anchorSize","anchorCornerRadius","enabledAnchors","ignoreStroke","anchorStroke","palette","anchorFill","anchorStrokeWidth","borderStroke","borderStrokeWidth","borderDash","keepRatio","boundBoxFunc"],"mappings":"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","sourcesContent":["import _extends from\"@babel/runtime/helpers/extends\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import React,{useEffect,useRef}from\"react\";import{Ellipse,Image,Rect,Transformer}from\"react-konva\";import Konva from\"konva\";import{useStore}from\"../../../hooks\";import{SET_CROP,SET_FEEDBACK}from\"../../../actions\";import{CUSTOM_CROP,ELLIPSE_CROP,FEEDBACK_STATUSES,ORIGINAL_CROP,TOOLS_IDS}from\"../../../utils/constants\";import{boundDragging,boundResizing}from\"./cropAreaBounding\";var CropTransformer=function(){var a=useStore(),b=a.dispatch,c=a.theme,d=a.designLayer,e=a.originalImage,f=a.shownImageDimensions,g=a.adjustments;g=void 0===g?{}:g;var h=g.crop,i=void 0===h?{}:h,j=g.isFlippedX,k=g.isFlippedY,l=a.resize,m=void 0===l?{}:l,n=a.config,o=a.t,p=useRef(),q=useRef(),r=useRef(),s=useRef(),t=n[TOOLS_IDS.CROP],u=i.ratio||t.ratio,v=u===CUSTOM_CROP,w=u===ELLIPSE_CROP,z=function(){return u===ORIGINAL_CROP?e.width/e.height:u},A=function(a,c){var d=a.width,e=a.height,g=a.x,h=a.y,l={x:j?f.width-g-d:g,y:k?f.height-h-e:h,width:d,height:e},n=i.width>=m.width&&i.height>=m.height;m.width&&m.height&&(d<m.width||e<m.height)&&n&&b({type:SET_FEEDBACK,payload:{feedback:{message:o(\"cropSizeLowerThanResizedWarning\"),status:FEEDBACK_STATUSES.WARNING}}}),b({type:SET_CROP,payload:_objectSpread(_objectSpread(_objectSpread({},i),l),{},{dismissHistory:c})})},B=function(a,b){var c,d;q.current&&p.current&&q.current.nodes([p.current]);var e=s.current,f={width:a,height:b,x:null!==(c=i.x)&&void 0!==c?c:0,y:null!==(d=i.y)&&void 0!==d?d:0};A(boundResizing(f,f,_objectSpread(_objectSpread({},e),{},{abstractX:0,abstractY:0}),!(v||w)&&z(),t),!0)};if(useEffect(function(){return d&&q.current&&p.current&&(r.current&&r.current.cache(),q.current.nodes([p.current])),function(){r.current&&r.current.clearCache()}},[d,e,f]),useEffect(function(){if(s.current){var a,b,c=s.current;B(null!==(a=i.width)&&void 0!==a?a:c.width,null!==(b=i.height)&&void 0!==b?b:c.height)}},[u]),useEffect(function(){q.current&&p.current&&s.current&&i.width&&i.height&&B(i.width,i.height)},[t,f.width,f.height]),useEffect(function(){f&&(s.current=f)},[f]),!d)return null;var C,D=v||w?void 0:[\"top-left\",\"bottom-left\",\"top-right\",\"bottom-right\"],E=function(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];a.target&&A({width:a.target.width()*a.target.scaleX(),height:a.target.height()*a.target.scaleY(),x:a.target.x(),y:a.target.y()},b)};if(!i.width&&!i.height){var F=1>f.scaledBy?f.scaledBy:1,G=_objectSpread(_objectSpread({},f),{},{width:f.width/F,height:f.height/F});C=boundResizing(G,_objectSpread(_objectSpread({},G),{},{x:0,y:0}),_objectSpread(_objectSpread({},G),{},{abstractX:0,abstractY:0}),!(v||w)&&z(),t)}else C=i;var H=C,I=H.x,J=void 0===I?0:I,x=H.y,K=void 0===x?0:x,y=H.width,L=H.height,M={x:j?f.width-J-y:J,y:k?f.height-K-L:K,ref:p,fill:\"#FFFFFF\",scaleX:1,scaleY:1,globalCompositeOperation:\"destination-out\",onDragEnd:E,onDragMove:function limitDragging(a){var b=a.target;b.setAttrs(boundDragging(b.attrs,s.current))},onTransformEnd:E,draggable:!0};return React.createElement(React.Fragment,null,React.createElement(Image,{image:e,x:j?f.width:0,y:k?f.height:0,width:f.width,height:f.height,filters:[Konva.Filters.Blur,Konva.Filters.Brighten],blurRadius:10,brightness:-.3,scaleX:j?-1:1,scaleY:k?-1:1,ref:r}),w?React.createElement(Ellipse,_extends({},M,{radiusX:y/2,radiusY:L/2,offset:{x:-y/2,y:-L/2}})):React.createElement(Rect,_extends({},M,{width:y,height:L})),React.createElement(Transformer,{centeredScaling:!1,flipEnabled:!1,rotateEnabled:!1,nodes:p.current?[p.current]:[],anchorSize:14,anchorCornerRadius:7,enabledAnchors:D,ignoreStroke:!1,anchorStroke:c.palette[\"accent-primary\"],anchorFill:c.palette[\"access-primary\"],anchorStrokeWidth:2,borderStroke:c.palette[\"accent-primary\"],borderStrokeWidth:2,borderDash:[4],keepRatio:!v||!w,ref:q,boundBoxFunc:function boundBoxFunc(a,b){return boundResizing(a,b,s.current,!(v||w)&&z(),t)}}))};export default CropTransformer;"]},"metadata":{},"sourceType":"module"}