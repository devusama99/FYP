{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"filter\"];\n\nfunction ownKeys(a, b) {\n  var c = Object.keys(a);\n\n  if (Object.getOwnPropertySymbols) {\n    var d = Object.getOwnPropertySymbols(a);\n    b && (d = d.filter(function (b) {\n      return Object.getOwnPropertyDescriptor(a, b).enumerable;\n    })), c.push.apply(c, d);\n  }\n\n  return c;\n}\n\nfunction _objectSpread(a) {\n  for (var b, c = 1; c < arguments.length; c++) b = null == arguments[c] ? {} : arguments[c], c % 2 ? ownKeys(Object(b), !0).forEach(function (c) {\n    _defineProperty(a, c, b[c]);\n  }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(a, Object.getOwnPropertyDescriptors(b)) : ownKeys(Object(b)).forEach(function (c) {\n    Object.defineProperty(a, c, Object.getOwnPropertyDescriptor(b, c));\n  });\n\n  return a;\n}\n\nimport Konva from \"konva\";\nimport { HIDE_LOADER, SET_SAVED } from \"../actions\";\nimport { ELLIPSE_CROP, IMAGE_NODE_ID, SUPPORTED_IMAGE_TYPES, TOOLS_IDS } from \"../utils/constants\";\nimport extractCurrentDesignState from \"../utils/extractCurrentDesignState\";\nimport mapCropBox from \"../utils/mapCropBox\";\nimport getSizeAfterRotation from \"../utils/getSizeAfterRotation\";\nimport imageToBase64 from \"../utils/imageToBase64\";\nimport getFileFullName from \"../utils/getFileFullName\";\nimport operationsToCloudimageUrl from \"../utils/operationsToCloudimageUrl\";\nimport useStore from \"./useStore\";\n\nvar useTransformedImgData = function () {\n  var a = useStore(),\n      b = a.dispatch,\n      c = a.designLayer,\n      d = a.shownImageDimensions,\n      e = a.originalImage,\n      f = a.adjustments,\n      g = f.crop,\n      h = f.rotation,\n      i = void 0 === h ? 0 : h,\n      j = f.isFlippedX,\n      k = f.isFlippedY,\n      l = a.config,\n      m = l.savingPixelRatio,\n      n = l.previewPixelRatio,\n      o = l.forceToPngInEllipticalCrop,\n      p = l.defaultSavedImageType,\n      q = l.useCloudimage,\n      r = l.cloudimage;\n  return q ? function getTransformedCloudimageData() {\n    var b,\n        c,\n        f = 0 < arguments.length && arguments[0] !== void 0 ? arguments[0] : {},\n        h = extractCurrentDesignState(a),\n        i = h.filter,\n        j = _objectWithoutProperties(h, _excluded),\n        k = operationsToCloudimageUrl(r, j, d, e),\n        l = mapCropBox({\n      x: g.x,\n      y: g.y,\n      width: g.width,\n      height: g.height\n    }, d, e),\n        m = {\n      cloudimageUrl: k,\n      width: (null === f || void 0 === f || null === (b = f.size) || void 0 === b ? void 0 : b.width) || l.width,\n      height: (null === f || void 0 === f || null === (c = f.size) || void 0 === c ? void 0 : c.height) || l.height\n    };\n\n    return {\n      imageData: m,\n      designState: j\n    };\n  } : function getTransformedImgData() {\n    var f = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : {},\n        h = !!(1 < arguments.length && void 0 !== arguments[1]) && arguments[1],\n        l = !!(2 < arguments.length && void 0 !== arguments[2]) && arguments[2];\n    Konva.pixelRatio = h || m;\n    var q = c.attrs,\n        r = q.clipWidth,\n        s = q.clipHeight,\n        t = q.clipX,\n        u = q.clipY;\n    c.setAttr(\"isSaving\", !0);\n\n    var v = c.getStage().clone({\n      width: e.width,\n      height: e.height,\n      scaleX: j ? -1 : 1,\n      scaleY: k ? -1 : 1\n    }),\n        w = _slicedToArray(v.children, 1),\n        x = w[0];\n\n    v.children[1].destroy();\n    var y = v.findOne(\"#\".concat(IMAGE_NODE_ID));\n    y.cache();\n    var z = {\n      x: v.width() / d.width,\n      y: v.height() / d.height\n    };\n    x.setAttrs({\n      rotation: 0,\n      offsetX: 0,\n      offsetY: 0,\n      x: 0,\n      y: 0,\n      scaleX: z.x,\n      scaleY: z.y\n    });\n\n    var A = _objectSpread(_objectSpread({}, (!f.name || !f.extension) && getFileFullName(e.name, o && g.ratio === ELLIPSE_CROP ? \"png\" : SUPPORTED_IMAGE_TYPES.includes(null === p || void 0 === p ? void 0 : p.toLowerCase()) && p)), f),\n        B = A.name,\n        C = A.extension,\n        D = A.quality,\n        E = void 0 === D ? 92 : D,\n        F = A.size,\n        G = void 0 === F ? {} : F,\n        H = [\"jpeg\", \"jpg\", \"webp\"].includes(C),\n        I = mapCropBox({\n      x: g.x || t,\n      y: g.y || u,\n      width: g.width || r,\n      height: g.height || s\n    }, d, v.attrs),\n        J = getSizeAfterRotation(I.width, I.height, i);\n\n    if (v.setAttrs({\n      offsetX: I.width / 2 + I.x,\n      offsetY: I.height / 2 + I.y,\n      width: J.width,\n      height: J.height,\n      x: J.width / 2,\n      y: J.height / 2,\n      rotation: i\n    }), G.width) {\n      var Q = (j ? -1 : 1) * (G.width / v.width());\n      v.setAttrs({\n        scaleX: Q,\n        width: G.width,\n        x: v.x() * Math.abs(Q)\n      });\n    }\n\n    if (G.height) {\n      var R = (k ? -1 : 1) * (G.height / v.height());\n      v.setAttrs({\n        scaleY: R,\n        height: G.height,\n        y: v.y() * Math.abs(R)\n      });\n    }\n\n    var K = _objectSpread({\n      mimeType: \"image/\".concat(\"jpg\" === C ? \"jpeg\" : C)\n    }, H ? {\n      quality: E\n    } : {}),\n        L = v.toCanvas(K),\n        M = v.toDataURL(K),\n        N = _objectSpread(_objectSpread({}, extractCurrentDesignState(a)), {}, {\n      shownImageDimensions: {\n        width: a.shownImageDimensions.width,\n        height: a.shownImageDimensions.height,\n        scaledBy: a.shownImageDimensions.scaledBy\n      }\n    });\n\n    N.filter && (N.filter = N.filter.name), N.finetunes = N.finetunes.map(function (a) {\n      return a.name;\n    }), Object.keys(N.annotations).forEach(function (a) {\n      var b,\n          c = N.annotations[a],\n          d = c.name === TOOLS_IDS.IMAGE && (null === (b = c.image) || void 0 === b ? void 0 : b.src);\n      d && d.startsWith(\"blob:\") ? N.annotations[a].image = imageToBase64(c.image) : c.image instanceof HTMLImageElement && (N.annotations[a].image = d);\n    });\n\n    var O = _objectSpread({\n      fullName: \"\".concat(B, \".\").concat(C),\n      name: B,\n      extension: C,\n      mimeType: \"image/\".concat(C),\n      imageCanvas: L,\n      imageBase64: M,\n      width: G.width || I.width,\n      height: G.height || I.height\n    }, H ? {\n      quality: E\n    } : {});\n\n    c.setAttr(\"isSaving\", !1), b({\n      type: SET_SAVED\n    }), y.clearCache(), Konva.pixelRatio = n;\n\n    var P = function () {\n      b({\n        type: HIDE_LOADER\n      });\n    };\n\n    return l || P(), {\n      imageData: O,\n      designState: N,\n      hideLoadingSpinner: P\n    };\n  };\n};\n\nexport default useTransformedImgData;","map":{"version":3,"sources":["/Users/devusama/Work/FYP_FrontEnd/node_modules/react-filerobot-image-editor/lib/hooks/useTransformedImgData.js"],"names":["_defineProperty","_slicedToArray","_objectWithoutProperties","_excluded","ownKeys","a","b","c","Object","keys","getOwnPropertySymbols","d","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","Konva","HIDE_LOADER","SET_SAVED","ELLIPSE_CROP","IMAGE_NODE_ID","SUPPORTED_IMAGE_TYPES","TOOLS_IDS","extractCurrentDesignState","mapCropBox","getSizeAfterRotation","imageToBase64","getFileFullName","operationsToCloudimageUrl","useStore","useTransformedImgData","dispatch","designLayer","shownImageDimensions","e","originalImage","f","adjustments","g","crop","h","rotation","i","j","isFlippedX","k","isFlippedY","l","config","m","savingPixelRatio","n","previewPixelRatio","o","forceToPngInEllipticalCrop","p","defaultSavedImageType","q","useCloudimage","r","cloudimage","getTransformedCloudimageData","x","y","width","height","cloudimageUrl","size","imageData","designState","getTransformedImgData","pixelRatio","attrs","clipWidth","s","clipHeight","t","clipX","u","clipY","setAttr","v","getStage","clone","scaleX","scaleY","w","children","destroy","findOne","concat","cache","z","setAttrs","offsetX","offsetY","A","name","extension","ratio","includes","toLowerCase","B","C","D","quality","E","F","G","H","I","J","Q","Math","abs","R","K","mimeType","L","toCanvas","M","toDataURL","N","scaledBy","finetunes","map","annotations","IMAGE","image","src","startsWith","HTMLImageElement","O","fullName","imageCanvas","imageBase64","type","clearCache","P","hideLoadingSpinner"],"mappings":"AAAA,OAAOA,eAAP,MAA2B,uCAA3B;AAAmE,OAAOC,cAAP,MAA0B,sCAA1B;AAAiE,OAAOC,wBAAP,MAAoC,gDAApC;AAAqF,IAAIC,SAAS,GAAC,CAAC,QAAD,CAAd;;AAAyB,SAASC,OAAT,CAAiBC,CAAjB,EAAmBC,CAAnB,EAAqB;AAAC,MAAIC,CAAC,GAACC,MAAM,CAACC,IAAP,CAAYJ,CAAZ,CAAN;;AAAqB,MAAGG,MAAM,CAACE,qBAAV,EAAgC;AAAC,QAAIC,CAAC,GAACH,MAAM,CAACE,qBAAP,CAA6BL,CAA7B,CAAN;AAAsCC,IAAAA,CAAC,KAAGK,CAAC,GAACA,CAAC,CAACC,MAAF,CAAS,UAASN,CAAT,EAAW;AAAC,aAAOE,MAAM,CAACK,wBAAP,CAAgCR,CAAhC,EAAkCC,CAAlC,EAAqCQ,UAA5C;AAAuD,KAA5E,CAAL,CAAD,EAAqFP,CAAC,CAACQ,IAAF,CAAOC,KAAP,CAAaT,CAAb,EAAeI,CAAf,CAArF;AAAuG;;AAAA,SAAOJ,CAAP;AAAS;;AAAA,SAASU,aAAT,CAAuBZ,CAAvB,EAAyB;AAAC,OAAI,IAAIC,CAAJ,EAAMC,CAAC,GAAC,CAAZ,EAAcA,CAAC,GAACW,SAAS,CAACC,MAA1B,EAAiCZ,CAAC,EAAlC,EAAqCD,CAAC,GAAC,QAAMY,SAAS,CAACX,CAAD,CAAf,GAAmB,EAAnB,GAAsBW,SAAS,CAACX,CAAD,CAAjC,EAAqCA,CAAC,GAAC,CAAF,GAAIH,OAAO,CAACI,MAAM,CAACF,CAAD,CAAP,EAAW,CAAC,CAAZ,CAAP,CAAsBc,OAAtB,CAA8B,UAASb,CAAT,EAAW;AAACP,IAAAA,eAAe,CAACK,CAAD,EAAGE,CAAH,EAAKD,CAAC,CAACC,CAAD,CAAN,CAAf;AAA0B,GAApE,CAAJ,GAA0EC,MAAM,CAACa,yBAAP,GAAiCb,MAAM,CAACc,gBAAP,CAAwBjB,CAAxB,EAA0BG,MAAM,CAACa,yBAAP,CAAiCf,CAAjC,CAA1B,CAAjC,GAAgGF,OAAO,CAACI,MAAM,CAACF,CAAD,CAAP,CAAP,CAAmBc,OAAnB,CAA2B,UAASb,CAAT,EAAW;AAACC,IAAAA,MAAM,CAACe,cAAP,CAAsBlB,CAAtB,EAAwBE,CAAxB,EAA0BC,MAAM,CAACK,wBAAP,CAAgCP,CAAhC,EAAkCC,CAAlC,CAA1B;AAAgE,GAAvG,CAA/M;;AAAwT,SAAOF,CAAP;AAAS;;AAAA,OAAOmB,KAAP,MAAiB,OAAjB;AAAyB,SAAOC,WAAP,EAAmBC,SAAnB,QAAiC,YAAjC;AAA8C,SAAOC,YAAP,EAAoBC,aAApB,EAAkCC,qBAAlC,EAAwDC,SAAxD,QAAsE,oBAAtE;AAA2F,OAAOC,yBAAP,MAAqC,oCAArC;AAA0E,OAAOC,UAAP,MAAsB,qBAAtB;AAA4C,OAAOC,oBAAP,MAAgC,+BAAhC;AAAgE,OAAOC,aAAP,MAAyB,wBAAzB;AAAkD,OAAOC,eAAP,MAA2B,0BAA3B;AAAsD,OAAOC,yBAAP,MAAqC,oCAArC;AAA0E,OAAOC,QAAP,MAAoB,YAApB;;AAAiC,IAAIC,qBAAqB,GAAC,YAAU;AAAC,MAAIjC,CAAC,GAACgC,QAAQ,EAAd;AAAA,MAAiB/B,CAAC,GAACD,CAAC,CAACkC,QAArB;AAAA,MAA8BhC,CAAC,GAACF,CAAC,CAACmC,WAAlC;AAAA,MAA8C7B,CAAC,GAACN,CAAC,CAACoC,oBAAlD;AAAA,MAAuEC,CAAC,GAACrC,CAAC,CAACsC,aAA3E;AAAA,MAAyFC,CAAC,GAACvC,CAAC,CAACwC,WAA7F;AAAA,MAAyGC,CAAC,GAACF,CAAC,CAACG,IAA7G;AAAA,MAAkHC,CAAC,GAACJ,CAAC,CAACK,QAAtH;AAAA,MAA+HC,CAAC,GAAC,KAAK,CAAL,KAASF,CAAT,GAAW,CAAX,GAAaA,CAA9I;AAAA,MAAgJG,CAAC,GAACP,CAAC,CAACQ,UAApJ;AAAA,MAA+JC,CAAC,GAACT,CAAC,CAACU,UAAnK;AAAA,MAA8KC,CAAC,GAAClD,CAAC,CAACmD,MAAlL;AAAA,MAAyLC,CAAC,GAACF,CAAC,CAACG,gBAA7L;AAAA,MAA8MC,CAAC,GAACJ,CAAC,CAACK,iBAAlN;AAAA,MAAoOC,CAAC,GAACN,CAAC,CAACO,0BAAxO;AAAA,MAAmQC,CAAC,GAACR,CAAC,CAACS,qBAAvQ;AAAA,MAA6RC,CAAC,GAACV,CAAC,CAACW,aAAjS;AAAA,MAA+SC,CAAC,GAACZ,CAAC,CAACa,UAAnT;AAA8T,SAAOH,CAAC,GAAC,SAASI,4BAAT,GAAuC;AAAC,QAAI/D,CAAJ;AAAA,QAAMC,CAAN;AAAA,QAAQqC,CAAC,GAAC,IAAE1B,SAAS,CAACC,MAAZ,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe,KAAK,CAAxC,GAA0CA,SAAS,CAAC,CAAD,CAAnD,GAAuD,EAAjE;AAAA,QAAoE8B,CAAC,GAACjB,yBAAyB,CAAC1B,CAAD,CAA/F;AAAA,QAAmG6C,CAAC,GAACF,CAAC,CAACpC,MAAvG;AAAA,QAA8GuC,CAAC,GAACjD,wBAAwB,CAAC8C,CAAD,EAAG7C,SAAH,CAAxI;AAAA,QAAsJkD,CAAC,GAACjB,yBAAyB,CAAC+B,CAAD,EAAGhB,CAAH,EAAKxC,CAAL,EAAO+B,CAAP,CAAjL;AAAA,QAA2La,CAAC,GAACvB,UAAU,CAAC;AAACsC,MAAAA,CAAC,EAACxB,CAAC,CAACwB,CAAL;AAAOC,MAAAA,CAAC,EAACzB,CAAC,CAACyB,CAAX;AAAaC,MAAAA,KAAK,EAAC1B,CAAC,CAAC0B,KAArB;AAA2BC,MAAAA,MAAM,EAAC3B,CAAC,CAAC2B;AAApC,KAAD,EAA6C9D,CAA7C,EAA+C+B,CAA/C,CAAvM;AAAA,QAAyPe,CAAC,GAAC;AAACiB,MAAAA,aAAa,EAACrB,CAAf;AAAiBmB,MAAAA,KAAK,EAAC,CAAC,SAAO5B,CAAP,IAAU,KAAK,CAAL,KAASA,CAAnB,IAAsB,UAAQtC,CAAC,GAACsC,CAAC,CAAC+B,IAAZ,CAAtB,IAAyC,KAAK,CAAL,KAASrE,CAAlD,GAAoD,KAAK,CAAzD,GAA2DA,CAAC,CAACkE,KAA9D,KAAsEjB,CAAC,CAACiB,KAA/F;AAAqGC,MAAAA,MAAM,EAAC,CAAC,SAAO7B,CAAP,IAAU,KAAK,CAAL,KAASA,CAAnB,IAAsB,UAAQrC,CAAC,GAACqC,CAAC,CAAC+B,IAAZ,CAAtB,IAAyC,KAAK,CAAL,KAASpE,CAAlD,GAAoD,KAAK,CAAzD,GAA2DA,CAAC,CAACkE,MAA9D,KAAuElB,CAAC,CAACkB;AAArL,KAA3P;;AAAwb,WAAM;AAACG,MAAAA,SAAS,EAACnB,CAAX;AAAaoB,MAAAA,WAAW,EAAC1B;AAAzB,KAAN;AAAkC,GAAngB,GAAogB,SAAS2B,qBAAT,GAAgC;AAAC,QAAIlC,CAAC,GAAC,IAAE1B,SAAS,CAACC,MAAZ,IAAoB,KAAK,CAAL,KAASD,SAAS,CAAC,CAAD,CAAtC,GAA0CA,SAAS,CAAC,CAAD,CAAnD,GAAuD,EAA7D;AAAA,QAAgE8B,CAAC,GAAC,CAAC,EAAE,IAAE9B,SAAS,CAACC,MAAZ,IAAoB,KAAK,CAAL,KAASD,SAAS,CAAC,CAAD,CAAxC,CAAD,IAA+CA,SAAS,CAAC,CAAD,CAA1H;AAAA,QAA8HqC,CAAC,GAAC,CAAC,EAAE,IAAErC,SAAS,CAACC,MAAZ,IAAoB,KAAK,CAAL,KAASD,SAAS,CAAC,CAAD,CAAxC,CAAD,IAA+CA,SAAS,CAAC,CAAD,CAAxL;AAA4LM,IAAAA,KAAK,CAACuD,UAAN,GAAiB/B,CAAC,IAAES,CAApB;AAAsB,QAAIQ,CAAC,GAAC1D,CAAC,CAACyE,KAAR;AAAA,QAAcb,CAAC,GAACF,CAAC,CAACgB,SAAlB;AAAA,QAA4BC,CAAC,GAACjB,CAAC,CAACkB,UAAhC;AAAA,QAA2CC,CAAC,GAACnB,CAAC,CAACoB,KAA/C;AAAA,QAAqDC,CAAC,GAACrB,CAAC,CAACsB,KAAzD;AAA+DhF,IAAAA,CAAC,CAACiF,OAAF,CAAU,UAAV,EAAqB,CAAC,CAAtB;;AAAyB,QAAIC,CAAC,GAAClF,CAAC,CAACmF,QAAF,GAAaC,KAAb,CAAmB;AAACnB,MAAAA,KAAK,EAAC9B,CAAC,CAAC8B,KAAT;AAAeC,MAAAA,MAAM,EAAC/B,CAAC,CAAC+B,MAAxB;AAA+BmB,MAAAA,MAAM,EAACzC,CAAC,GAAC,CAAC,CAAF,GAAI,CAA3C;AAA6C0C,MAAAA,MAAM,EAACxC,CAAC,GAAC,CAAC,CAAF,GAAI;AAAzD,KAAnB,CAAN;AAAA,QAAsFyC,CAAC,GAAC7F,cAAc,CAACwF,CAAC,CAACM,QAAH,EAAY,CAAZ,CAAtG;AAAA,QAAqHzB,CAAC,GAACwB,CAAC,CAAC,CAAD,CAAxH;;AAA4HL,IAAAA,CAAC,CAACM,QAAF,CAAW,CAAX,EAAcC,OAAd;AAAwB,QAAIzB,CAAC,GAACkB,CAAC,CAACQ,OAAF,CAAU,IAAIC,MAAJ,CAAWtE,aAAX,CAAV,CAAN;AAA2C2C,IAAAA,CAAC,CAAC4B,KAAF;AAAU,QAAIC,CAAC,GAAC;AAAC9B,MAAAA,CAAC,EAACmB,CAAC,CAACjB,KAAF,KAAU7D,CAAC,CAAC6D,KAAf;AAAqBD,MAAAA,CAAC,EAACkB,CAAC,CAAChB,MAAF,KAAW9D,CAAC,CAAC8D;AAApC,KAAN;AAAkDH,IAAAA,CAAC,CAAC+B,QAAF,CAAW;AAACpD,MAAAA,QAAQ,EAAC,CAAV;AAAYqD,MAAAA,OAAO,EAAC,CAApB;AAAsBC,MAAAA,OAAO,EAAC,CAA9B;AAAgCjC,MAAAA,CAAC,EAAC,CAAlC;AAAoCC,MAAAA,CAAC,EAAC,CAAtC;AAAwCqB,MAAAA,MAAM,EAACQ,CAAC,CAAC9B,CAAjD;AAAmDuB,MAAAA,MAAM,EAACO,CAAC,CAAC7B;AAA5D,KAAX;;AAA2E,QAAIiC,CAAC,GAACvF,aAAa,CAACA,aAAa,CAAC,EAAD,EAAI,CAAC,CAAC2B,CAAC,CAAC6D,IAAH,IAAS,CAAC7D,CAAC,CAAC8D,SAAb,KAAyBvE,eAAe,CAACO,CAAC,CAAC+D,IAAH,EAAQ5C,CAAC,IAAEf,CAAC,CAAC6D,KAAF,KAAUhF,YAAb,GAA0B,KAA1B,GAAgCE,qBAAqB,CAAC+E,QAAtB,CAA+B,SAAO7C,CAAP,IAAU,KAAK,CAAL,KAASA,CAAnB,GAAqB,KAAK,CAA1B,GAA4BA,CAAC,CAAC8C,WAAF,EAA3D,KAA6E9C,CAArH,CAA5C,CAAd,EAAmLnB,CAAnL,CAAnB;AAAA,QAAyMkE,CAAC,GAACN,CAAC,CAACC,IAA7M;AAAA,QAAkNM,CAAC,GAACP,CAAC,CAACE,SAAtN;AAAA,QAAgOM,CAAC,GAACR,CAAC,CAACS,OAApO;AAAA,QAA4OC,CAAC,GAAC,KAAK,CAAL,KAASF,CAAT,GAAW,EAAX,GAAcA,CAA5P;AAAA,QAA8PG,CAAC,GAACX,CAAC,CAAC7B,IAAlQ;AAAA,QAAuQyC,CAAC,GAAC,KAAK,CAAL,KAASD,CAAT,GAAW,EAAX,GAAcA,CAAvR;AAAA,QAAyRE,CAAC,GAAC,CAAC,MAAD,EAAQ,KAAR,EAAc,MAAd,EAAsBT,QAAtB,CAA+BG,CAA/B,CAA3R;AAAA,QAA6TO,CAAC,GAACtF,UAAU,CAAC;AAACsC,MAAAA,CAAC,EAACxB,CAAC,CAACwB,CAAF,IAAKc,CAAR;AAAUb,MAAAA,CAAC,EAACzB,CAAC,CAACyB,CAAF,IAAKe,CAAjB;AAAmBd,MAAAA,KAAK,EAAC1B,CAAC,CAAC0B,KAAF,IAASL,CAAlC;AAAoCM,MAAAA,MAAM,EAAC3B,CAAC,CAAC2B,MAAF,IAAUS;AAArD,KAAD,EAAyDvE,CAAzD,EAA2D8E,CAAC,CAACT,KAA7D,CAAzU;AAAA,QAA6YuC,CAAC,GAACtF,oBAAoB,CAACqF,CAAC,CAAC9C,KAAH,EAAS8C,CAAC,CAAC7C,MAAX,EAAkBvB,CAAlB,CAAna;;AAAwb,QAAGuC,CAAC,CAACY,QAAF,CAAW;AAACC,MAAAA,OAAO,EAACgB,CAAC,CAAC9C,KAAF,GAAQ,CAAR,GAAU8C,CAAC,CAAChD,CAArB;AAAuBiC,MAAAA,OAAO,EAACe,CAAC,CAAC7C,MAAF,GAAS,CAAT,GAAW6C,CAAC,CAAC/C,CAA5C;AAA8CC,MAAAA,KAAK,EAAC+C,CAAC,CAAC/C,KAAtD;AAA4DC,MAAAA,MAAM,EAAC8C,CAAC,CAAC9C,MAArE;AAA4EH,MAAAA,CAAC,EAACiD,CAAC,CAAC/C,KAAF,GAAQ,CAAtF;AAAwFD,MAAAA,CAAC,EAACgD,CAAC,CAAC9C,MAAF,GAAS,CAAnG;AAAqGxB,MAAAA,QAAQ,EAACC;AAA9G,KAAX,GAA6HkE,CAAC,CAAC5C,KAAlI,EAAwI;AAAC,UAAIgD,CAAC,GAAC,CAACrE,CAAC,GAAC,CAAC,CAAF,GAAI,CAAN,KAAUiE,CAAC,CAAC5C,KAAF,GAAQiB,CAAC,CAACjB,KAAF,EAAlB,CAAN;AAAmCiB,MAAAA,CAAC,CAACY,QAAF,CAAW;AAACT,QAAAA,MAAM,EAAC4B,CAAR;AAAUhD,QAAAA,KAAK,EAAC4C,CAAC,CAAC5C,KAAlB;AAAwBF,QAAAA,CAAC,EAACmB,CAAC,CAACnB,CAAF,KAAMmD,IAAI,CAACC,GAAL,CAASF,CAAT;AAAhC,OAAX;AAAyD;;AAAA,QAAGJ,CAAC,CAAC3C,MAAL,EAAY;AAAC,UAAIkD,CAAC,GAAC,CAACtE,CAAC,GAAC,CAAC,CAAF,GAAI,CAAN,KAAU+D,CAAC,CAAC3C,MAAF,GAASgB,CAAC,CAAChB,MAAF,EAAnB,CAAN;AAAqCgB,MAAAA,CAAC,CAACY,QAAF,CAAW;AAACR,QAAAA,MAAM,EAAC8B,CAAR;AAAUlD,QAAAA,MAAM,EAAC2C,CAAC,CAAC3C,MAAnB;AAA0BF,QAAAA,CAAC,EAACkB,CAAC,CAAClB,CAAF,KAAMkD,IAAI,CAACC,GAAL,CAASC,CAAT;AAAlC,OAAX;AAA2D;;AAAA,QAAIC,CAAC,GAAC3G,aAAa,CAAC;AAAC4G,MAAAA,QAAQ,EAAC,SAAS3B,MAAT,CAAgB,UAAQa,CAAR,GAAU,MAAV,GAAiBA,CAAjC;AAAV,KAAD,EAAgDM,CAAC,GAAC;AAACJ,MAAAA,OAAO,EAACC;AAAT,KAAD,GAAa,EAA9D,CAAnB;AAAA,QAAqFY,CAAC,GAACrC,CAAC,CAACsC,QAAF,CAAWH,CAAX,CAAvF;AAAA,QAAqGI,CAAC,GAACvC,CAAC,CAACwC,SAAF,CAAYL,CAAZ,CAAvG;AAAA,QAAsHM,CAAC,GAACjH,aAAa,CAACA,aAAa,CAAC,EAAD,EAAIc,yBAAyB,CAAC1B,CAAD,CAA7B,CAAd,EAAgD,EAAhD,EAAmD;AAACoC,MAAAA,oBAAoB,EAAC;AAAC+B,QAAAA,KAAK,EAACnE,CAAC,CAACoC,oBAAF,CAAuB+B,KAA9B;AAAoCC,QAAAA,MAAM,EAACpE,CAAC,CAACoC,oBAAF,CAAuBgC,MAAlE;AAAyE0D,QAAAA,QAAQ,EAAC9H,CAAC,CAACoC,oBAAF,CAAuB0F;AAAzG;AAAtB,KAAnD,CAArI;;AAAmUD,IAAAA,CAAC,CAACtH,MAAF,KAAWsH,CAAC,CAACtH,MAAF,GAASsH,CAAC,CAACtH,MAAF,CAAS6F,IAA7B,GAAmCyB,CAAC,CAACE,SAAF,GAAYF,CAAC,CAACE,SAAF,CAAYC,GAAZ,CAAgB,UAAShI,CAAT,EAAW;AAAC,aAAOA,CAAC,CAACoG,IAAT;AAAc,KAA1C,CAA/C,EAA2FjG,MAAM,CAACC,IAAP,CAAYyH,CAAC,CAACI,WAAd,EAA2BlH,OAA3B,CAAmC,UAASf,CAAT,EAAW;AAAC,UAAIC,CAAJ;AAAA,UAAMC,CAAC,GAAC2H,CAAC,CAACI,WAAF,CAAcjI,CAAd,CAAR;AAAA,UAAyBM,CAAC,GAACJ,CAAC,CAACkG,IAAF,KAAS3E,SAAS,CAACyG,KAAnB,KAA2B,UAAQjI,CAAC,GAACC,CAAC,CAACiI,KAAZ,KAAoB,KAAK,CAAL,KAASlI,CAA7B,GAA+B,KAAK,CAApC,GAAsCA,CAAC,CAACmI,GAAnE,CAA3B;AAAmG9H,MAAAA,CAAC,IAAEA,CAAC,CAAC+H,UAAF,CAAa,OAAb,CAAH,GAAyBR,CAAC,CAACI,WAAF,CAAcjI,CAAd,EAAiBmI,KAAjB,GAAuBtG,aAAa,CAAC3B,CAAC,CAACiI,KAAH,CAA7D,GAAuEjI,CAAC,CAACiI,KAAF,YAAmBG,gBAAnB,KAAsCT,CAAC,CAACI,WAAF,CAAcjI,CAAd,EAAiBmI,KAAjB,GAAuB7H,CAA7D,CAAvE;AAAuI,KAAzR,CAA3F;;AAAsX,QAAIiI,CAAC,GAAC3H,aAAa,CAAC;AAAC4H,MAAAA,QAAQ,EAAC,GAAG3C,MAAH,CAAUY,CAAV,EAAY,GAAZ,EAAiBZ,MAAjB,CAAwBa,CAAxB,CAAV;AAAqCN,MAAAA,IAAI,EAACK,CAA1C;AAA4CJ,MAAAA,SAAS,EAACK,CAAtD;AAAwDc,MAAAA,QAAQ,EAAC,SAAS3B,MAAT,CAAgBa,CAAhB,CAAjE;AAAoF+B,MAAAA,WAAW,EAAChB,CAAhG;AAAkGiB,MAAAA,WAAW,EAACf,CAA9G;AAAgHxD,MAAAA,KAAK,EAAC4C,CAAC,CAAC5C,KAAF,IAAS8C,CAAC,CAAC9C,KAAjI;AAAuIC,MAAAA,MAAM,EAAC2C,CAAC,CAAC3C,MAAF,IAAU6C,CAAC,CAAC7C;AAA1J,KAAD,EAAmK4C,CAAC,GAAC;AAACJ,MAAAA,OAAO,EAACC;AAAT,KAAD,GAAa,EAAjL,CAAnB;;AAAwM3G,IAAAA,CAAC,CAACiF,OAAF,CAAU,UAAV,EAAqB,CAAC,CAAtB,GAAyBlF,CAAC,CAAC;AAAC0I,MAAAA,IAAI,EAACtH;AAAN,KAAD,CAA1B,EAA6C6C,CAAC,CAAC0E,UAAF,EAA7C,EAA4DzH,KAAK,CAACuD,UAAN,GAAiBpB,CAA7E;;AAA+E,QAAIuF,CAAC,GAAC,YAAU;AAAC5I,MAAAA,CAAC,CAAC;AAAC0I,QAAAA,IAAI,EAACvH;AAAN,OAAD,CAAD;AAAsB,KAAvC;;AAAwC,WAAO8B,CAAC,IAAE2F,CAAC,EAAJ,EAAO;AAACtE,MAAAA,SAAS,EAACgE,CAAX;AAAa/D,MAAAA,WAAW,EAACqD,CAAzB;AAA2BiB,MAAAA,kBAAkB,EAACD;AAA9C,KAAd;AAA+D,GAA99F;AAA+9F,CAAl0G;;AAAm0G,eAAe5G,qBAAf","sourcesContent":["import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";var _excluded=[\"filter\"];function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import Konva from\"konva\";import{HIDE_LOADER,SET_SAVED}from\"../actions\";import{ELLIPSE_CROP,IMAGE_NODE_ID,SUPPORTED_IMAGE_TYPES,TOOLS_IDS}from\"../utils/constants\";import extractCurrentDesignState from\"../utils/extractCurrentDesignState\";import mapCropBox from\"../utils/mapCropBox\";import getSizeAfterRotation from\"../utils/getSizeAfterRotation\";import imageToBase64 from\"../utils/imageToBase64\";import getFileFullName from\"../utils/getFileFullName\";import operationsToCloudimageUrl from\"../utils/operationsToCloudimageUrl\";import useStore from\"./useStore\";var useTransformedImgData=function(){var a=useStore(),b=a.dispatch,c=a.designLayer,d=a.shownImageDimensions,e=a.originalImage,f=a.adjustments,g=f.crop,h=f.rotation,i=void 0===h?0:h,j=f.isFlippedX,k=f.isFlippedY,l=a.config,m=l.savingPixelRatio,n=l.previewPixelRatio,o=l.forceToPngInEllipticalCrop,p=l.defaultSavedImageType,q=l.useCloudimage,r=l.cloudimage;return q?function getTransformedCloudimageData(){var b,c,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},h=extractCurrentDesignState(a),i=h.filter,j=_objectWithoutProperties(h,_excluded),k=operationsToCloudimageUrl(r,j,d,e),l=mapCropBox({x:g.x,y:g.y,width:g.width,height:g.height},d,e),m={cloudimageUrl:k,width:(null===f||void 0===f||null===(b=f.size)||void 0===b?void 0:b.width)||l.width,height:(null===f||void 0===f||null===(c=f.size)||void 0===c?void 0:c.height)||l.height};return{imageData:m,designState:j}}:function getTransformedImgData(){var f=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},h=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],l=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];Konva.pixelRatio=h||m;var q=c.attrs,r=q.clipWidth,s=q.clipHeight,t=q.clipX,u=q.clipY;c.setAttr(\"isSaving\",!0);var v=c.getStage().clone({width:e.width,height:e.height,scaleX:j?-1:1,scaleY:k?-1:1}),w=_slicedToArray(v.children,1),x=w[0];v.children[1].destroy();var y=v.findOne(\"#\".concat(IMAGE_NODE_ID));y.cache();var z={x:v.width()/d.width,y:v.height()/d.height};x.setAttrs({rotation:0,offsetX:0,offsetY:0,x:0,y:0,scaleX:z.x,scaleY:z.y});var A=_objectSpread(_objectSpread({},(!f.name||!f.extension)&&getFileFullName(e.name,o&&g.ratio===ELLIPSE_CROP?\"png\":SUPPORTED_IMAGE_TYPES.includes(null===p||void 0===p?void 0:p.toLowerCase())&&p)),f),B=A.name,C=A.extension,D=A.quality,E=void 0===D?92:D,F=A.size,G=void 0===F?{}:F,H=[\"jpeg\",\"jpg\",\"webp\"].includes(C),I=mapCropBox({x:g.x||t,y:g.y||u,width:g.width||r,height:g.height||s},d,v.attrs),J=getSizeAfterRotation(I.width,I.height,i);if(v.setAttrs({offsetX:I.width/2+I.x,offsetY:I.height/2+I.y,width:J.width,height:J.height,x:J.width/2,y:J.height/2,rotation:i}),G.width){var Q=(j?-1:1)*(G.width/v.width());v.setAttrs({scaleX:Q,width:G.width,x:v.x()*Math.abs(Q)})}if(G.height){var R=(k?-1:1)*(G.height/v.height());v.setAttrs({scaleY:R,height:G.height,y:v.y()*Math.abs(R)})}var K=_objectSpread({mimeType:\"image/\".concat(\"jpg\"===C?\"jpeg\":C)},H?{quality:E}:{}),L=v.toCanvas(K),M=v.toDataURL(K),N=_objectSpread(_objectSpread({},extractCurrentDesignState(a)),{},{shownImageDimensions:{width:a.shownImageDimensions.width,height:a.shownImageDimensions.height,scaledBy:a.shownImageDimensions.scaledBy}});N.filter&&(N.filter=N.filter.name),N.finetunes=N.finetunes.map(function(a){return a.name}),Object.keys(N.annotations).forEach(function(a){var b,c=N.annotations[a],d=c.name===TOOLS_IDS.IMAGE&&(null===(b=c.image)||void 0===b?void 0:b.src);d&&d.startsWith(\"blob:\")?N.annotations[a].image=imageToBase64(c.image):c.image instanceof HTMLImageElement&&(N.annotations[a].image=d)});var O=_objectSpread({fullName:\"\".concat(B,\".\").concat(C),name:B,extension:C,mimeType:\"image/\".concat(C),imageCanvas:L,imageBase64:M,width:G.width||I.width,height:G.height||I.height},H?{quality:E}:{});c.setAttr(\"isSaving\",!1),b({type:SET_SAVED}),y.clearCache(),Konva.pixelRatio=n;var P=function(){b({type:HIDE_LOADER})};return l||P(),{imageData:O,designState:N,hideLoadingSpinner:P}}};export default useTransformedImgData;"]},"metadata":{},"sourceType":"module"}