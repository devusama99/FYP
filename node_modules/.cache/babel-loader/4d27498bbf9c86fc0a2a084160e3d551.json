{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\n\nfunction ownKeys(a, b) {\n  var c = Object.keys(a);\n\n  if (Object.getOwnPropertySymbols) {\n    var d = Object.getOwnPropertySymbols(a);\n    b && (d = d.filter(function (b) {\n      return Object.getOwnPropertyDescriptor(a, b).enumerable;\n    })), c.push.apply(c, d);\n  }\n\n  return c;\n}\n\nfunction _objectSpread(a) {\n  for (var b, c = 1; c < arguments.length; c++) b = null == arguments[c] ? {} : arguments[c], c % 2 ? ownKeys(Object(b), !0).forEach(function (c) {\n    _defineProperty(a, c, b[c]);\n  }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(a, Object.getOwnPropertyDescriptors(b)) : ownKeys(Object(b)).forEach(function (c) {\n    Object.defineProperty(a, c, Object.getOwnPropertyDescriptor(b, c));\n  });\n\n  return a;\n}\n\nimport React, { useCallback, useEffect, useMemo, useRef } from \"react\";\nimport { Image, Layer } from \"react-konva\";\nimport getDimensionsMinimalRatio from \"../../../utils/getDimensionsMinimalRatio\";\nimport cropImage from \"../../../utils/cropImage\";\nimport { DESIGN_LAYER_ID, IMAGE_NODE_ID, TOOLS_IDS } from \"../../../utils/constants\";\nimport { SET_SHOWN_IMAGE_DIMENSIONS } from \"../../../actions\";\nimport getProperImageToCanvasSpacing from \"../../../utils/getProperImageToCanvasSpacing\";\nimport { useStore } from \"../../../hooks\";\nimport getSizeAfterRotation from \"../../../utils/getSizeAfterRotation\";\nimport getCenterRotatedPoint from \"../../../utils/getCenterRotatedPoint\";\nimport AnnotationNodes from \"./AnnotationNodes\";\nimport PreviewGroup from \"./PreviewGroup\";\n\nvar CANVAS_TO_IMG_SPACING = getProperImageToCanvasSpacing(),\n    DesignLayer = function () {\n  var a,\n      b,\n      c,\n      d,\n      e = useRef(),\n      f = useStore(),\n      g = f.initialCanvasWidth,\n      h = f.initialCanvasHeight,\n      i = f.canvasWidth,\n      j = f.canvasHeight,\n      k = f.dispatch,\n      l = f.toolId,\n      m = f.canvasScale,\n      n = f.originalImage,\n      o = void 0 === n ? {} : n,\n      p = f.finetunes,\n      q = void 0 === p ? [] : p,\n      r = f.finetunesProps,\n      s = void 0 === r ? {} : r,\n      t = f.filter,\n      u = void 0 === t ? null : t,\n      v = f.adjustments;\n  v = void 0 === v ? {} : v;\n  var w = v.rotation,\n      x = void 0 === w ? 0 : w,\n      y = v.crop,\n      z = void 0 === y ? {} : y,\n      A = v.isFlippedX,\n      B = v.isFlippedY,\n      C = f.resize,\n      D = useRef(),\n      E = useRef(),\n      F = l === TOOLS_IDS.CROP,\n      G = useMemo(function () {\n    return u ? [].concat(_toConsumableArray(q), [u]) : q;\n  }, [q, u]),\n      H = useMemo(function () {\n    var a = o.width - CANVAS_TO_IMG_SPACING,\n        b = o.width / o.height;\n    return {\n      width: a,\n      height: a / b\n    };\n  }, [o]),\n      I = useMemo(function () {\n    return getSizeAfterRotation(o.width, o.height, x);\n  }, [o, x]),\n      J = useMemo(function () {\n    return getDimensionsMinimalRatio(g, h, o.width, o.height);\n  }, [o, g, h]),\n      K = useMemo(function () {\n    return {\n      width: H.width * J,\n      height: H.height * J\n    };\n  }, [H, J]),\n      L = C.width && !F ? C.width / (null !== (a = null !== (b = z.width) && void 0 !== b ? b : K.width) && void 0 !== a ? a : I.width) : 1,\n      M = C.height && !F ? C.height / (null !== (c = null !== (d = z.height) && void 0 !== d ? d : K.height) && void 0 !== c ? c : I.height) : 1,\n      N = i / (2 * m) - K.width * L / 2,\n      O = j / (2 * m) - K.height * M / 2,\n      P = i / (2 * m) - K.width / 2,\n      Q = j / (2 * m) - K.height / 2,\n      R = useMemo(function () {\n    return {\n      x: Math.round(N),\n      y: Math.round(O),\n      abstractX: Math.round(P),\n      abstractY: Math.round(Q),\n      width: K.width,\n      height: K.height,\n      scaledBy: m\n    };\n  }, [m, N, O, P, Q, K]),\n      S = useCallback(function () {\n    D.current ? D.current.cache() : setTimeout(S, 0);\n  }, []),\n      T = getSizeAfterRotation(R.width, R.height, x),\n      U = F ? 1 : getDimensionsMinimalRatio(R.width, R.height, T.width, T.height);\n  if (useEffect(function () {\n    return o && S(), function () {\n      var a;\n      null === (a = D.current) || void 0 === a ? void 0 : a.clearCache();\n    };\n  }, [o]), useEffect(function () {\n    R && k({\n      type: SET_SHOWN_IMAGE_DIMENSIONS,\n      payload: {\n        shownImageDimensions: R,\n        designLayer: e.current,\n        previewGroup: E.current\n      }\n    });\n  }, [R]), !N || !O || !R) return null;\n\n  var V = getCenterRotatedPoint(z.x, z.y, x),\n      W = N + (!F && z.width ? (A ? -1 : 1) * (R.width / 2 - z.x - z.width / 2 + V.x) * L : 0),\n      X = O + (!F && z.height ? (B ? -1 : 1) * (R.height / 2 - z.y - z.height / 2 + V.y) * M : 0),\n      Y = F ? P : W,\n      Z = F ? Q : X,\n      $ = (A ? -1 : 1) * (F ? 1 : L) * U,\n      _ = (B ? -1 : 1) * (F ? 1 : M) * U;\n\n  return React.createElement(Layer, {\n    id: DESIGN_LAYER_ID,\n    ref: e,\n    xPadding: Y,\n    yPadding: Z,\n    offsetX: K.width / 2,\n    offsetY: K.height / 2,\n    x: K.width * L / 2 + Y,\n    y: K.height * M / 2 + Z,\n    scaleX: $,\n    scaleY: _,\n    rotation: F ? 0 : x,\n    clipFunc: function clipFunc(a) {\n      var b,\n          c,\n          d = F && !(null !== (b = e.current) && void 0 !== b && null !== (c = b.attrs) && void 0 !== c && c.isSaving),\n          f = d ? _objectSpread(_objectSpread({}, R), {}, {\n        x: 0,\n        y: 0\n      }) : {\n        width: z.width || R.width,\n        height: z.height || R.height,\n        x: z.x || 0,\n        y: z.y || 0\n      };\n      cropImage(a, _objectSpread({\n        ratio: z.ratio\n      }, f), d), e.current && e.current.setAttrs({\n        clipX: f.x,\n        clipY: f.y,\n        clipWidth: f.width,\n        clipHeight: f.height\n      });\n    }\n  }, React.createElement(Image, _extends({\n    id: IMAGE_NODE_ID,\n    image: o,\n    width: K.width,\n    height: K.height,\n    offsetX: K.width / 2,\n    offsetY: K.height / 2,\n    x: K.width / 2,\n    y: K.height / 2,\n    listening: !1,\n    filters: G,\n    ref: D\n  }, s)), React.createElement(AnnotationNodes, null), React.createElement(PreviewGroup, {\n    ref: E\n  }));\n};\n\nexport default DesignLayer;","map":{"version":3,"sources":["/Users/devusama/Work/FYP_FrontEnd/node_modules/react-filerobot-image-editor/lib/components/Layers/DesignLayer/index.js"],"names":["_extends","_defineProperty","_toConsumableArray","ownKeys","a","b","c","Object","keys","getOwnPropertySymbols","d","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","React","useCallback","useEffect","useMemo","useRef","Image","Layer","getDimensionsMinimalRatio","cropImage","DESIGN_LAYER_ID","IMAGE_NODE_ID","TOOLS_IDS","SET_SHOWN_IMAGE_DIMENSIONS","getProperImageToCanvasSpacing","useStore","getSizeAfterRotation","getCenterRotatedPoint","AnnotationNodes","PreviewGroup","CANVAS_TO_IMG_SPACING","DesignLayer","e","f","g","initialCanvasWidth","h","initialCanvasHeight","i","canvasWidth","j","canvasHeight","k","dispatch","l","toolId","m","canvasScale","n","originalImage","o","p","finetunes","q","r","finetunesProps","s","t","u","v","adjustments","w","rotation","x","y","crop","z","A","isFlippedX","B","isFlippedY","C","resize","D","E","F","CROP","G","concat","H","width","height","I","J","K","L","M","N","O","P","Q","R","Math","round","abstractX","abstractY","scaledBy","S","current","cache","setTimeout","T","U","clearCache","type","payload","shownImageDimensions","designLayer","previewGroup","V","W","X","Y","Z","$","_","createElement","id","ref","xPadding","yPadding","offsetX","offsetY","scaleX","scaleY","clipFunc","attrs","isSaving","ratio","setAttrs","clipX","clipY","clipWidth","clipHeight","image","listening","filters"],"mappings":"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","sourcesContent":["import _extends from\"@babel/runtime/helpers/extends\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import React,{useCallback,useEffect,useMemo,useRef}from\"react\";import{Image,Layer}from\"react-konva\";import getDimensionsMinimalRatio from\"../../../utils/getDimensionsMinimalRatio\";import cropImage from\"../../../utils/cropImage\";import{DESIGN_LAYER_ID,IMAGE_NODE_ID,TOOLS_IDS}from\"../../../utils/constants\";import{SET_SHOWN_IMAGE_DIMENSIONS}from\"../../../actions\";import getProperImageToCanvasSpacing from\"../../../utils/getProperImageToCanvasSpacing\";import{useStore}from\"../../../hooks\";import getSizeAfterRotation from\"../../../utils/getSizeAfterRotation\";import getCenterRotatedPoint from\"../../../utils/getCenterRotatedPoint\";import AnnotationNodes from\"./AnnotationNodes\";import PreviewGroup from\"./PreviewGroup\";var CANVAS_TO_IMG_SPACING=getProperImageToCanvasSpacing(),DesignLayer=function(){var a,b,c,d,e=useRef(),f=useStore(),g=f.initialCanvasWidth,h=f.initialCanvasHeight,i=f.canvasWidth,j=f.canvasHeight,k=f.dispatch,l=f.toolId,m=f.canvasScale,n=f.originalImage,o=void 0===n?{}:n,p=f.finetunes,q=void 0===p?[]:p,r=f.finetunesProps,s=void 0===r?{}:r,t=f.filter,u=void 0===t?null:t,v=f.adjustments;v=void 0===v?{}:v;var w=v.rotation,x=void 0===w?0:w,y=v.crop,z=void 0===y?{}:y,A=v.isFlippedX,B=v.isFlippedY,C=f.resize,D=useRef(),E=useRef(),F=l===TOOLS_IDS.CROP,G=useMemo(function(){return u?[].concat(_toConsumableArray(q),[u]):q},[q,u]),H=useMemo(function(){var a=o.width-CANVAS_TO_IMG_SPACING,b=o.width/o.height;return{width:a,height:a/b}},[o]),I=useMemo(function(){return getSizeAfterRotation(o.width,o.height,x)},[o,x]),J=useMemo(function(){return getDimensionsMinimalRatio(g,h,o.width,o.height)},[o,g,h]),K=useMemo(function(){return{width:H.width*J,height:H.height*J}},[H,J]),L=C.width&&!F?C.width/(null!==(a=null!==(b=z.width)&&void 0!==b?b:K.width)&&void 0!==a?a:I.width):1,M=C.height&&!F?C.height/(null!==(c=null!==(d=z.height)&&void 0!==d?d:K.height)&&void 0!==c?c:I.height):1,N=i/(2*m)-K.width*L/2,O=j/(2*m)-K.height*M/2,P=i/(2*m)-K.width/2,Q=j/(2*m)-K.height/2,R=useMemo(function(){return{x:Math.round(N),y:Math.round(O),abstractX:Math.round(P),abstractY:Math.round(Q),width:K.width,height:K.height,scaledBy:m}},[m,N,O,P,Q,K]),S=useCallback(function(){D.current?D.current.cache():setTimeout(S,0)},[]),T=getSizeAfterRotation(R.width,R.height,x),U=F?1:getDimensionsMinimalRatio(R.width,R.height,T.width,T.height);if(useEffect(function(){return o&&S(),function(){var a;null===(a=D.current)||void 0===a?void 0:a.clearCache()}},[o]),useEffect(function(){R&&k({type:SET_SHOWN_IMAGE_DIMENSIONS,payload:{shownImageDimensions:R,designLayer:e.current,previewGroup:E.current}})},[R]),!N||!O||!R)return null;var V=getCenterRotatedPoint(z.x,z.y,x),W=N+(!F&&z.width?(A?-1:1)*(R.width/2-z.x-z.width/2+V.x)*L:0),X=O+(!F&&z.height?(B?-1:1)*(R.height/2-z.y-z.height/2+V.y)*M:0),Y=F?P:W,Z=F?Q:X,$=(A?-1:1)*(F?1:L)*U,_=(B?-1:1)*(F?1:M)*U;return React.createElement(Layer,{id:DESIGN_LAYER_ID,ref:e,xPadding:Y,yPadding:Z,offsetX:K.width/2,offsetY:K.height/2,x:K.width*L/2+Y,y:K.height*M/2+Z,scaleX:$,scaleY:_,rotation:F?0:x,clipFunc:function clipFunc(a){var b,c,d=F&&!(null!==(b=e.current)&&void 0!==b&&null!==(c=b.attrs)&&void 0!==c&&c.isSaving),f=d?_objectSpread(_objectSpread({},R),{},{x:0,y:0}):{width:z.width||R.width,height:z.height||R.height,x:z.x||0,y:z.y||0};cropImage(a,_objectSpread({ratio:z.ratio},f),d),e.current&&e.current.setAttrs({clipX:f.x,clipY:f.y,clipWidth:f.width,clipHeight:f.height})}},React.createElement(Image,_extends({id:IMAGE_NODE_ID,image:o,width:K.width,height:K.height,offsetX:K.width/2,offsetY:K.height/2,x:K.width/2,y:K.height/2,listening:!1,filters:G,ref:D},s)),React.createElement(AnnotationNodes,null),React.createElement(PreviewGroup,{ref:E}))};export default DesignLayer;"]},"metadata":{},"sourceType":"module"}