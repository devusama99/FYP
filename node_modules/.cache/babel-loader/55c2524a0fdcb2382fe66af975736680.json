{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction ownKeys(a, b) {\n  var c = Object.keys(a);\n\n  if (Object.getOwnPropertySymbols) {\n    var d = Object.getOwnPropertySymbols(a);\n    b && (d = d.filter(function (b) {\n      return Object.getOwnPropertyDescriptor(a, b).enumerable;\n    })), c.push.apply(c, d);\n  }\n\n  return c;\n}\n\nfunction _objectSpread(a) {\n  for (var b, c = 1; c < arguments.length; c++) b = null == arguments[c] ? {} : arguments[c], c % 2 ? ownKeys(Object(b), !0).forEach(function (c) {\n    _defineProperty(a, c, b[c]);\n  }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(a, Object.getOwnPropertyDescriptors(b)) : ownKeys(Object(b)).forEach(function (c) {\n    Object.defineProperty(a, c, Object.getOwnPropertyDescriptor(b, c));\n  });\n\n  return a;\n}\n\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport Text from \"@scaleflex/icons/text\";\nimport UploadOutline from \"@scaleflex/icons/upload-outline\";\nimport { SELECT_ANNOTATION, SET_ANNOTATION, SET_FEEDBACK, CLEAR_ANNOTATIONS_SELECTIONS } from \"../../../actions\";\nimport ButtonWithMenu from \"../../common/ButtonWithMenu\";\nimport TextControls from \"../Text/TextOptions/TextControls\";\nimport ImageControls from \"../Image/ImageControls\";\nimport { usePhoneScreen, useStore } from \"../../../hooks\";\nimport { FEEDBACK_STATUSES, TOOLS_IDS } from \"../../../utils/constants\";\nimport HiddenUploadInput from \"../../common/HiddenUploadInput\";\nimport { StyledControlsWrapper, StyledWatermarkWrapper } from \"./Watermark.styled\";\nimport WatermarksGallery from \"./WatermarksGallery\";\nimport WatermarkPadding from \"./WatermarkPadding\";\n\nvar WATERMARK_IMG_RATIO_FROM_ORIGINAL = .33,\n    WATERMARK_ANNOTATION_ID = \"watermark\",\n    Watermark = function () {\n  var a = useStore(),\n      b = a.annotations,\n      c = a.shownImageDimensions,\n      d = a.selectionsIds,\n      e = a.config,\n      f = a.dispatch,\n      g = a.t,\n      h = a.adjustments.crop,\n      i = void 0 === h ? {} : h,\n      j = usePhoneScreen(),\n      k = useState(!1),\n      l = _slicedToArray(k, 2),\n      m = l[0],\n      n = l[1],\n      o = useRef(),\n      p = useMemo(function () {\n    return b[WATERMARK_ANNOTATION_ID];\n  }, [b[WATERMARK_ANNOTATION_ID]]),\n      q = i.width || c.width,\n      r = i.height || c.height,\n      s = i.x || 0,\n      t = i.y || 0,\n      u = function (a) {\n    var b = a.width / a.height,\n        c = {};\n\n    if (r > q) {\n      var g = r * WATERMARK_IMG_RATIO_FROM_ORIGINAL / a.height;\n      c.height = a.height * g, c.width = c.height * b;\n    } else {\n      var h = q * WATERMARK_IMG_RATIO_FROM_ORIGINAL / a.width;\n      c.width = a.width * h, c.height = c.width / b;\n    }\n\n    var d = _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, e.annotationsCommon), e[TOOLS_IDS.IMAGE]), c), {}, {\n      padding: 1,\n      image: a,\n      x: s + q / 2 - c.width / 2,\n      y: t + r / 2 - c.height / 2,\n      id: WATERMARK_ANNOTATION_ID,\n      name: TOOLS_IDS.IMAGE,\n      replaceCurrent: !0\n    });\n\n    f({\n      type: SET_ANNOTATION,\n      payload: d\n    });\n  },\n      v = function (a) {\n    f({\n      type: SET_ANNOTATION,\n      payload: _objectSpread(_objectSpread({}, \"function\" == typeof a ? a(p) : a), {}, {\n        id: WATERMARK_ANNOTATION_ID\n      })\n    });\n  },\n      w = [!e.useCloudimage && {\n    key: \"upload-watermark\",\n    label: g(\"uploadWatermark\"),\n    icon: UploadOutline,\n    onClick: function onClick() {\n      o.current && o.current.click();\n    }\n  }, {\n    key: \"add-text-watermark\",\n    label: g(\"addWatermarkAsText\"),\n    icon: Text,\n    onClick: function addTextWatermark() {\n      var a = {\n        height: r * WATERMARK_IMG_RATIO_FROM_ORIGINAL,\n        width: q * WATERMARK_IMG_RATIO_FROM_ORIGINAL\n      },\n          b = _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, e.annotationsCommon), e[TOOLS_IDS.TEXT]), a), {}, {\n        padding: 1,\n        x: s + q / 2 - a.width / 2,\n        y: t + r / 2 - a.height / 2,\n        fill: \"#000000\",\n        id: WATERMARK_ANNOTATION_ID,\n        name: TOOLS_IDS.TEXT,\n        replaceCurrent: !0\n      });\n\n      f({\n        type: SET_ANNOTATION,\n        payload: b\n      });\n    }\n  }],\n      x = function (a) {\n    f({\n      type: SET_FEEDBACK,\n      payload: {\n        feedback: {\n          message: a,\n          status: FEEDBACK_STATUSES.WARNING\n        }\n      }\n    });\n  };\n\n  useEffect(function () {\n    p && (f({\n      type: CLEAR_ANNOTATIONS_SELECTIONS\n    }), f({\n      type: SELECT_ANNOTATION,\n      payload: {\n        annotationId: \"watermark\"\n      }\n    }));\n  }, [p]), useEffect(function () {\n    p && (0 === d.length || d[0].id !== WATERMARK_ANNOTATION_ID) && f({\n      type: SELECT_ANNOTATION,\n      payload: {\n        annotationId: \"watermark\"\n      }\n    });\n  }, [d]);\n\n  var y = function () {\n    return React.createElement(WatermarkPadding, {\n      watermark: p,\n      saveWatermark: v,\n      t: g\n    });\n  };\n\n  return React.createElement(\"div\", {\n    className: \"FIE_watermark-tool-wrapper\"\n  }, (null === p || void 0 === p ? void 0 : p.name) === TOOLS_IDS.TEXT && React.createElement(StyledControlsWrapper, {\n    className: \"FIE_watermark-options-wrapper\"\n  }, React.createElement(TextControls, {\n    text: p,\n    saveText: v,\n    t: g\n  }, y())), (null === p || void 0 === p ? void 0 : p.name) === TOOLS_IDS.IMAGE && React.createElement(StyledControlsWrapper, {\n    className: \"FIE_watermark-options-wrapper\"\n  }, React.createElement(ImageControls, {\n    image: p,\n    saveImage: v,\n    t: g\n  }, y())), React.createElement(StyledWatermarkWrapper, {\n    className: \"FIE_watermark-add-wrapper\",\n    noWrap: !(!(null !== p && void 0 !== p) || !p.name)\n  }, React.createElement(ButtonWithMenu, {\n    className: \"FIE_watermark-add\",\n    color: \"secondary\",\n    label: g(\"addWatermark\"),\n    title: g(\"addWatermarkTitle\"),\n    menuPosition: \"top\",\n    menuItems: w,\n    menuFromBtn: !0\n  }), React.createElement(WatermarksGallery, {\n    selectWatermark: u,\n    style: j && !(!(null !== p && void 0 !== p) || !p.name) ? {\n      width: \"55%\"\n    } : void 0\n  }), React.createElement(HiddenUploadInput, {\n    onChange: m ? void 0 : function importWatermarkImg(a) {\n      if (a.target.files) {\n        n(!0);\n        var b = a.target.files[0];\n\n        if (b.type.startsWith(\"image/\")) {\n          var c = new Image();\n          c.onload = function () {\n            u(c), URL.revokeObjectURL(b), n(!1);\n          }, c.onerror = function () {\n            x(g(\"uploadImageError\")), n(!1);\n          }, c.src = URL.createObjectURL(b);\n        }\n      }\n\n      a.target.value = \"\";\n    },\n    disabled: m,\n    ref: o\n  })));\n};\n\nexport default Watermark;","map":{"version":3,"sources":["/Users/devusama/Work/FYP_FrontEnd/node_modules/react-filerobot-image-editor/lib/components/tools/Watermark/Watermark.js"],"names":["_defineProperty","_slicedToArray","ownKeys","a","b","c","Object","keys","getOwnPropertySymbols","d","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","React","useEffect","useMemo","useRef","useState","Text","UploadOutline","SELECT_ANNOTATION","SET_ANNOTATION","SET_FEEDBACK","CLEAR_ANNOTATIONS_SELECTIONS","ButtonWithMenu","TextControls","ImageControls","usePhoneScreen","useStore","FEEDBACK_STATUSES","TOOLS_IDS","HiddenUploadInput","StyledControlsWrapper","StyledWatermarkWrapper","WatermarksGallery","WatermarkPadding","WATERMARK_IMG_RATIO_FROM_ORIGINAL","WATERMARK_ANNOTATION_ID","Watermark","annotations","shownImageDimensions","selectionsIds","e","config","f","dispatch","g","t","h","adjustments","crop","i","j","k","l","m","n","o","p","q","width","r","height","s","x","y","u","annotationsCommon","IMAGE","padding","image","id","name","replaceCurrent","type","payload","v","w","useCloudimage","key","label","icon","onClick","current","click","addTextWatermark","TEXT","fill","feedback","message","status","WARNING","annotationId","createElement","watermark","saveWatermark","className","text","saveText","saveImage","noWrap","color","title","menuPosition","menuItems","menuFromBtn","selectWatermark","style","onChange","importWatermarkImg","target","files","startsWith","Image","onload","URL","revokeObjectURL","onerror","src","createObjectURL","value","disabled","ref"],"mappings":"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","sourcesContent":["import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import React,{useEffect,useMemo,useRef,useState}from\"react\";import Text from\"@scaleflex/icons/text\";import UploadOutline from\"@scaleflex/icons/upload-outline\";import{SELECT_ANNOTATION,SET_ANNOTATION,SET_FEEDBACK,CLEAR_ANNOTATIONS_SELECTIONS}from\"../../../actions\";import ButtonWithMenu from\"../../common/ButtonWithMenu\";import TextControls from\"../Text/TextOptions/TextControls\";import ImageControls from\"../Image/ImageControls\";import{usePhoneScreen,useStore}from\"../../../hooks\";import{FEEDBACK_STATUSES,TOOLS_IDS}from\"../../../utils/constants\";import HiddenUploadInput from\"../../common/HiddenUploadInput\";import{StyledControlsWrapper,StyledWatermarkWrapper}from\"./Watermark.styled\";import WatermarksGallery from\"./WatermarksGallery\";import WatermarkPadding from\"./WatermarkPadding\";var WATERMARK_IMG_RATIO_FROM_ORIGINAL=.33,WATERMARK_ANNOTATION_ID=\"watermark\",Watermark=function(){var a=useStore(),b=a.annotations,c=a.shownImageDimensions,d=a.selectionsIds,e=a.config,f=a.dispatch,g=a.t,h=a.adjustments.crop,i=void 0===h?{}:h,j=usePhoneScreen(),k=useState(!1),l=_slicedToArray(k,2),m=l[0],n=l[1],o=useRef(),p=useMemo(function(){return b[WATERMARK_ANNOTATION_ID]},[b[WATERMARK_ANNOTATION_ID]]),q=i.width||c.width,r=i.height||c.height,s=i.x||0,t=i.y||0,u=function(a){var b=a.width/a.height,c={};if(r>q){var g=r*WATERMARK_IMG_RATIO_FROM_ORIGINAL/a.height;c.height=a.height*g,c.width=c.height*b}else{var h=q*WATERMARK_IMG_RATIO_FROM_ORIGINAL/a.width;c.width=a.width*h,c.height=c.width/b}var d=_objectSpread(_objectSpread(_objectSpread(_objectSpread({},e.annotationsCommon),e[TOOLS_IDS.IMAGE]),c),{},{padding:1,image:a,x:s+q/2-c.width/2,y:t+r/2-c.height/2,id:WATERMARK_ANNOTATION_ID,name:TOOLS_IDS.IMAGE,replaceCurrent:!0});f({type:SET_ANNOTATION,payload:d})},v=function(a){f({type:SET_ANNOTATION,payload:_objectSpread(_objectSpread({},\"function\"==typeof a?a(p):a),{},{id:WATERMARK_ANNOTATION_ID})})},w=[!e.useCloudimage&&{key:\"upload-watermark\",label:g(\"uploadWatermark\"),icon:UploadOutline,onClick:function onClick(){o.current&&o.current.click()}},{key:\"add-text-watermark\",label:g(\"addWatermarkAsText\"),icon:Text,onClick:function addTextWatermark(){var a={height:r*WATERMARK_IMG_RATIO_FROM_ORIGINAL,width:q*WATERMARK_IMG_RATIO_FROM_ORIGINAL},b=_objectSpread(_objectSpread(_objectSpread(_objectSpread({},e.annotationsCommon),e[TOOLS_IDS.TEXT]),a),{},{padding:1,x:s+q/2-a.width/2,y:t+r/2-a.height/2,fill:\"#000000\",id:WATERMARK_ANNOTATION_ID,name:TOOLS_IDS.TEXT,replaceCurrent:!0});f({type:SET_ANNOTATION,payload:b})}}],x=function(a){f({type:SET_FEEDBACK,payload:{feedback:{message:a,status:FEEDBACK_STATUSES.WARNING}}})};useEffect(function(){p&&(f({type:CLEAR_ANNOTATIONS_SELECTIONS}),f({type:SELECT_ANNOTATION,payload:{annotationId:\"watermark\"}}))},[p]),useEffect(function(){p&&(0===d.length||d[0].id!==WATERMARK_ANNOTATION_ID)&&f({type:SELECT_ANNOTATION,payload:{annotationId:\"watermark\"}})},[d]);var y=function(){return React.createElement(WatermarkPadding,{watermark:p,saveWatermark:v,t:g})};return React.createElement(\"div\",{className:\"FIE_watermark-tool-wrapper\"},(null===p||void 0===p?void 0:p.name)===TOOLS_IDS.TEXT&&React.createElement(StyledControlsWrapper,{className:\"FIE_watermark-options-wrapper\"},React.createElement(TextControls,{text:p,saveText:v,t:g},y())),(null===p||void 0===p?void 0:p.name)===TOOLS_IDS.IMAGE&&React.createElement(StyledControlsWrapper,{className:\"FIE_watermark-options-wrapper\"},React.createElement(ImageControls,{image:p,saveImage:v,t:g},y())),React.createElement(StyledWatermarkWrapper,{className:\"FIE_watermark-add-wrapper\",noWrap:!(!(null!==p&&void 0!==p)||!p.name)},React.createElement(ButtonWithMenu,{className:\"FIE_watermark-add\",color:\"secondary\",label:g(\"addWatermark\"),title:g(\"addWatermarkTitle\"),menuPosition:\"top\",menuItems:w,menuFromBtn:!0}),React.createElement(WatermarksGallery,{selectWatermark:u,style:j&&!(!(null!==p&&void 0!==p)||!p.name)?{width:\"55%\"}:void 0}),React.createElement(HiddenUploadInput,{onChange:m?void 0:function importWatermarkImg(a){if(a.target.files){n(!0);var b=a.target.files[0];if(b.type.startsWith(\"image/\")){var c=new Image;c.onload=function(){u(c),URL.revokeObjectURL(b),n(!1)},c.onerror=function(){x(g(\"uploadImageError\")),n(!1)},c.src=URL.createObjectURL(b)}}a.target.value=\"\"},disabled:m,ref:o})))};export default Watermark;"]},"metadata":{},"sourceType":"module"}